<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clinical trials analysis - 2&nbsp; Power and sample size calculations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./02-PhaseII.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-NI.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power and sample size calculations</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Clinical trials analysis</a> 
        <div class="sidebar-tools-main">
    <a href="./Clinical-trials-analysis.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-NI.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power and sample size calculations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-PhaseII.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phase II trials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">2.1</span> Background</a></li>
  <li><a href="#two-arm-non-inferiority-setting" id="toc-two-arm-non-inferiority-setting" class="nav-link" data-scroll-target="#two-arm-non-inferiority-setting"><span class="header-section-number">2.2</span> Two-arm non-inferiority setting</a>
  <ul>
  <li><a href="#binomial-outcome" id="toc-binomial-outcome" class="nav-link" data-scroll-target="#binomial-outcome"><span class="header-section-number">2.2.1</span> Binomial outcome</a>
  <ul class="collapse">
  <li><a href="#frequentist-approach" id="toc-frequentist-approach" class="nav-link" data-scroll-target="#frequentist-approach"><span class="header-section-number">2.2.1.1</span> Frequentist approach</a></li>
  <li><a href="#hybrid-approach-prior-on-the-risk-difference" id="toc-hybrid-approach-prior-on-the-risk-difference" class="nav-link" data-scroll-target="#hybrid-approach-prior-on-the-risk-difference"><span class="header-section-number">2.2.1.2</span> Hybrid approach: Prior on the risk difference</a></li>
  <li><a href="#bayesian-approach-prior-on-the-risk-difference" id="toc-bayesian-approach-prior-on-the-risk-difference" class="nav-link" data-scroll-target="#bayesian-approach-prior-on-the-risk-difference"><span class="header-section-number">2.2.1.3</span> Bayesian approach: Prior on the risk difference</a></li>
  <li><a href="#hybrid-approach-prior-on-event-probabilities" id="toc-hybrid-approach-prior-on-event-probabilities" class="nav-link" data-scroll-target="#hybrid-approach-prior-on-event-probabilities"><span class="header-section-number">2.2.1.4</span> Hybrid approach: Prior on event probabilities</a></li>
  <li><a href="#bayesian-approach-prior-on-event-probabilities" id="toc-bayesian-approach-prior-on-event-probabilities" class="nav-link" data-scroll-target="#bayesian-approach-prior-on-event-probabilities"><span class="header-section-number">2.2.1.5</span> Bayesian approach: Prior on event probabilities</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power and sample size calculations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="background" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="background"><span class="header-section-number">2.1</span> Background</h2>
<p>The terminology of ‘power’ is often imprecisely used <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>. Kunzmann et al.&nbsp;suggest to use the neutral term ‘probability to reject’. The classical (frequentist) ‘power’ is defined as the probability to reject given that the alternative hypothesis is true. Frequentist power calculations do not include uncertainties of the treatment effect, whereas Bayesian and hybrid approaches include such uncertainties in their calculations. In the following we use different approaches for the calculation of the ‘probability to reject’ (frequentist, Bayesian and hybrid) for different clinical trial designs.</p>
<p><strong>Definition ‘hybrid’</strong> (<span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span>, Section 6.5.2)</p>
<p><em>‘[…] we have a prior distribution to use in our study design, but that the conclusions of the study will be entirely classical and will not make use of the prior […]’</em></p>
</section>
<section id="two-arm-non-inferiority-setting" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="two-arm-non-inferiority-setting"><span class="header-section-number">2.2</span> Two-arm non-inferiority setting</h2>
<p>In this section we consider a non-inferiority clinical trial setting with a null hypothesis <span class="math inline">\(H_0: \delta &gt; \delta^*\)</span> and alternative hypothesis <span class="math inline">\(H_a: \delta \leq \delta^*\)</span>, where <span class="math inline">\(\delta^*&gt;0\)</span> is a fixed non-inferiority margin and a treatment effect <span class="math inline">\(\delta\)</span>, for example, a continuous difference or a risk difference.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="binomial-outcome" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="binomial-outcome"><span class="header-section-number">2.2.1</span> Binomial outcome</h3>
<p>Here <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_0\)</span> are event probabilities from an active treatment arm and a control arm, respectively. <span class="math inline">\(\delta=p_1-p_0\)</span> is the true treatment effect expressed as a risk difference.</p>
<p>In this section we assume that the variances in both groups are known, but might be different.</p>
<hr>
<p><strong>Working example</strong></p>
<p>We use the SAFE-SSPE trial as a working example <span class="citation" data-cites="Baumgartner2020">[<a href="references.html#ref-Baumgartner2020" role="doc-biblioref">3</a>]</span>. In brief, this non-inferiority randomised placebo-controlled trial compares clinical surveillance versus anticoagulant treatment in low-risk patients with isolated subsegmental pulmonary embolism (SSPE). The primary outcome is the proportion of 3-month recurrence of venous thromboembolism (VTE).</p>
<p>The null hypothesis <span class="math inline">\(H_0\)</span> is <em>‘clinical surveillance is inferior to anticoagulant treatment’</em> versus the alternative hypothesis <span class="math inline">\(H_a\)</span> <em>‘clinical surveillance is non-inferior to anticoagulant treatment’</em>. Thus, <span class="math inline">\(H_0: p_1-p_0&gt;\delta^*\)</span> vs <span class="math inline">\(H_a: p_1-p_0\leq \delta^*\)</span>, where <span class="math inline">\(p_1\)</span> is the VTE proportion in the clinical surveillance arm and <span class="math inline">\(p_0\)</span> is the VTE proportion in the control arm.</p>
<p>The non-inferiority margin was set at 3.5% and it was assumed that the proportion of VTE in both groups was 1%.</p>
<hr>
<section id="frequentist-approach" class="level4" data-number="2.2.1.1">
<h4 data-number="2.2.1.1" class="anchored" data-anchor-id="frequentist-approach"><span class="header-section-number">2.2.1.1</span> Frequentist approach</h4>
<p>Let <span class="math inline">\(Y_{i}=(Y_{i,1}, Y_{i,2}, \cdots, Y_{i,n_i})^\top\)</span> be a sample of size <span class="math inline">\(n_i\)</span> from a binomial distribution <span class="math inline">\(Y_{i} \sim Binomial(p_i, n_i)\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>, where <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>, are the true event proportions. Denote the estimated event proportions as <span class="math inline">\(\overline p_i=\frac{1}{n_i}\sum_{k\leq n_i} Y_{i,k}\)</span>, <span class="math inline">\(i\in {0,1}\)</span>, and the estimated risk difference as <span class="math inline">\(D=\overline p_1-\overline p_0\)</span>. Then <span class="math inline">\(D\)</span> is asymptotically Gaussian distributed <span class="math inline">\(D \sim N\left(\delta, \frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\right)\)</span>, where <span class="math inline">\(\sigma_i^2=p_i(1-p_i)\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. For notational purposes we denote the variance of the treatment effect as <span class="math inline">\(\sigma_{treat}^2=\frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\)</span>.</p>
<p>We are interested whether the upper <span class="math inline">\((1-\alpha)\%\)</span>-confidence limit of <span class="math inline">\(D\)</span> is smaller than the non-inferiority margin <span class="math inline">\(\delta^*\)</span>, that is, <span class="math display">\[
D+z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}\leq \delta^* \quad \Rightarrow \quad D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*,
\]</span> where <span class="math inline">\(z_{1-\alpha}=\Phi^{-1}(1-\alpha)\)</span>. Note that <span class="math inline">\(D_{suc}^{\delta^*}:=-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*\)</span> is the <strong>required risk difference</strong> for a ‘successful’ rejection of the null hypothesis. Then <span class="math display">\[
\begin{aligned}
P_\delta(D\leq D_{suc}^{\delta^*})&amp;=\Phi\left(-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta-\delta^*)\right) \\
&amp;=\Phi\left(-z_{1-\alpha}-\frac{(\delta-\delta^*)}{\sigma_{treat}}\right),
\end{aligned}
\]</span> since under regularity conditions, <span class="math display">\[
Z=\frac{D-\delta^*}{\sigma_{treat}} \rightarrow N(0,1), \quad \min(n_1,n_0) \rightarrow \infty.
\]</span></p>
<p>The conditional probability <span class="math inline">\(P_{\delta}(D\leq D_{suc}^{\delta^*})\)</span> is the <strong>probability to reject given</strong> <span class="math inline">\(\delta\)</span>. For <span class="math inline">\(\delta&gt;\delta^*\)</span> this is the ‘type-I error’ and for <span class="math inline">\(\delta\leq\delta^*\)</span> the frequentist ‘power’.</p>
<p>For a <span class="math inline">\(\delta_A\)</span> it holds that <span class="math display">\[
-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta_A-\delta^*)=\Phi^{-1}(1-\beta)=z_{1-\beta}
\]</span> and so the sample size can then be calculated as <span class="math display">\[
\frac{(z_{1-\beta}+z_{1-\alpha})^2}{(\delta_A-\delta^*)^2}=\frac{an_0^2}{n_0\sigma_1^2+an_0\sigma_0^2},
\]</span> where <span class="math inline">\(a=n_1/n_0\)</span> is an allocation ratio, such that <span class="math display">\[
n_0=(z_{1-\beta}+z_{1-\alpha})^2\frac{\sigma_1^2+a\sigma_0^2}{a(\delta_A-\delta^*)^2}, \quad n_1=an_0.
\]</span></p>
<p><span class="math inline">\(\delta_0\)</span>, <span class="math inline">\(\delta_A\)</span> and <span class="math inline">\(\delta^*\)</span> are assumed as fixed and known constants in a frequentist approach. Their choices are of high importance, because all trial conclusions are based on those choices and affect the sample size calculation. The plot below shows how the sample size increase as <span class="math inline">\(\delta^*\)</span> approaches <span class="math inline">\(\delta\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We calculate the required sample size for the SAFE-SSPE trial using a frequentist approach with the following parameters:</p>
<ul>
<li><span class="math inline">\(p_1=0.01\)</span>, <span class="math inline">\(p_0=0.01\)</span>, <span class="math inline">\(\delta^*=0.035\)</span>, <span class="math inline">\(1-\beta=0.8\)</span>, <span class="math inline">\(\alpha=0.05\)</span>, <span class="math inline">\(a=1/1\)</span></li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epiR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>p_0 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> p_1 <span class="sc">-</span> p_0</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sd_0 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_0 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_0))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sd_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_1 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_1))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">epi.ssninfb</span>(<span class="at">treat =</span> p_1, <span class="at">control =</span> p_0, <span class="at">delta =</span> delta_star, <span class="at">power =</span> <span class="dv">1</span> <span class="sc">-</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    beta, <span class="at">r =</span> a, <span class="at">alpha =</span> alpha, <span class="at">n =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$n.total
[1] 200

$n.treat
[1] 100

$n.control
[1] 100

$delta
[1] 0.035

$power
[1] 0.8</code></pre>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>n_0 <span class="ot">&lt;-</span> ((<span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> ((sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(a <span class="sc">*</span> (delta <span class="sc">-</span> delta_star)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>n_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93031</code></pre>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> n_0 <span class="sc">*</span> a</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93031</code></pre>
</div>
</div>
<p>Under the specified parameters a sample size of 200 patients (100 per arm) is needed to reject the null hypothesis of inferiority. This is more or less the sample size mentioned in the study protocol of the SAFE-SSPE trial but without dropouts and adjustments for rare events.</p>
<hr>
</section>
<section id="hybrid-approach-prior-on-the-risk-difference" class="level4" data-number="2.2.1.2">
<h4 data-number="2.2.1.2" class="anchored" data-anchor-id="hybrid-approach-prior-on-the-risk-difference"><span class="header-section-number">2.2.1.2</span> Hybrid approach: Prior on the risk difference</h4>
<p>Suppose that the true treatment effect <span class="math inline">\(\delta\)</span> is a realization from a random variable <span class="math inline">\(\Delta\)</span> with <span class="math inline">\(f(\delta)\)</span>. In this subsection we assume that the design prior comes from a Gaussian distribution function so that <span class="math inline">\(\Delta \sim N\left(d, \frac{\sigma_1^2+\sigma_0^2}{m}\right)\)</span>. Note that this prior can be thought as a realisation from <span class="math inline">\(m\)</span> Gaussian ‘prior observations’ with variance <span class="math inline">\(\sigma_1^2+\sigma_0^2\)</span>. Again for notational purposes we denote the variance of the design prior of the treatment effect as <span class="math inline">\(\sigma_{prior}^2=\frac{\sigma_1^2+\sigma_0^2}{m}\)</span>.</p>
<p>In the following we will use the following design priors:</p>
<ul>
<li><strong>Enthusiastic prior</strong> (favors non-inferiority): <span class="math inline">\(d=0\)</span>, <span class="math inline">\(m=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;\delta^*)=0.05\)</span>. This prior is centered on the treatment effect such that there is a low probability (here 5%) of inferiority.</li>
<li><strong>Skeptical prior</strong> (favors inferiority): <span class="math inline">\(d=\delta^*\)</span>, <span class="math inline">\(m=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;0)=0.05\)</span>. This prior is centered on the non-inferiority margin such that there is a low probability (here 5%) of superiority.</li>
<li><strong>Informative prior</strong> (clinical expert knowledge): <span class="math inline">\(d=0\)</span> with <span class="math inline">\(m=25\)</span>.</li>
<li><strong>Noninformative prior</strong>: <span class="math inline">\(d=0\)</span> with <span class="math inline">\(m=0.5\)</span>.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let <span class="math display">\[
AP:=\int_{\Delta} P_{\delta}(D\leq D_{suc}^{\delta^*})f(\delta)d\delta,
\]</span></p>
<p>be the <strong>‘average power’</strong> <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">4</a>]</span> (also called ‘assurance’ <span class="citation" data-cites="OHagan2005">[<a href="references.html#ref-OHagan2005" role="doc-biblioref">5</a>]</span>, ‘probability of success’ <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>, <span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span> or Bayesian predictive power <span class="citation" data-cites="Rufibach2016">[<a href="references.html#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>. Kunzmann et al.&nbsp;provide in their supplemental section a literature review of the used terminology in publications from clinical trials <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>).</p>
<p>In the hybrid approach we are interested in trial conclusions from a frequentist point of view, thus we are interested in <span class="math display">\[
D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*.
\]</span></p>
<p>Then, for a <span class="math inline">\(\tilde D\)</span> from future observations, <span class="math display">\[
\begin{aligned}
AP&amp;=\int_{-\infty}^{-\infty}P_{\delta}(D\leq D_{suc}^{d,\delta^*})f(\delta)d\delta \\
&amp;=\int_{-\infty}^{-\infty}\left\{\int_{-\infty}^{-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*}f(\tilde \delta| \delta)d\tilde \delta \right\}f(\delta)d\delta\\
&amp;=\int_{-\infty}^{-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*}\left\{ \int_{-\infty}^{-\infty} f(\tilde \delta| \delta)f(\delta)d\delta \right\}d\tilde \delta\\
&amp;=\int_{-\infty}^{-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*}f(\tilde\delta)d\tilde\delta \\
&amp;=\Phi\left(\frac{1}{\sigma_{prior}}\left[-z_{1-\alpha}\sigma_{treat}-(d-\delta^*)\right]\right),
\end{aligned}
\]</span> since the predictive distribution of <span class="math inline">\(\tilde D\)</span> is Gaussian distributed <span class="math inline">\(\tilde D \sim N\left(d, \sigma_{treat}^2+\sigma_{prior}^2\right)\)</span> under a design prior <span class="math inline">\(\Delta \sim N\left(d, \sigma_{prior}^2\right)\)</span> (<span class="citation" data-cites="Gelman2013">[<a href="references.html#ref-Gelman2013" role="doc-biblioref">7</a>]</span>, <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">4</a>]</span>). Note that as <span class="math inline">\(m \rightarrow \infty\)</span>, then <span class="math inline">\(AP \rightarrow \Phi\left(-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}\right)\)</span>, that is, the frequentist power at <span class="math inline">\(d\)</span>.</p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We calculate the AP under the assumed prior distributions and parameters for the SAFE-SSPE trial.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Enthusiastic"</span>, n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Skeptical"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP, <span class="dv">2</span>)))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Informative"</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP, <span class="dv">2</span>)))</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Noninformative"</span>,</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP, <span class="dv">2</span>)))</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(data_output <span class="sc">%&gt;%</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            type      n_0      n_1   AP
1   Enthusiastic 99.93031 99.93031 0.59
2    Informative 99.93031 99.93031 0.66
3 Noninformative 99.93031 99.93031 0.52
4      Skeptical 99.93031 99.93031 0.34</code></pre>
</div>
</div>
<p>Under an ‘enthusiastic prior’ we get an average power of 59%. For a ‘skeptical prior’ the average power decreases to 34%. These values are lower than the frequentist power of 80%, which holds under the assumption that the specified treatment effect (the alternative hypothesis) is true.</p>
<hr>
<p>Rufibach et al.&nbsp;give a closed a formula for the distribution of <span class="math inline">\(P_\Delta(D\leq D_{suc}^{\delta^*})\)</span>, where <span class="math inline">\(\Delta \sim N(d,\sigma^2_{prior})\)</span>, and discuss the shape under different prior choices <span class="citation" data-cites="Rufibach2016">[<a href="references.html#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>. Kunzmann et al.&nbsp;call this the ’random probability to reject` (RPR), <span class="math inline">\(RPR:=P_\Delta(D\leq D_{suc}^{\delta^*})\)</span>.</p>
<p>For <span class="math inline">\(0&lt;y&lt;1\)</span>, the random variable <span class="math inline">\(RPR\)</span> has a pdf <span class="math display">\[
\begin{aligned}
f(y)&amp;=\frac{\sigma_{treat}}{\sigma_{prior}} \phi\left(-z_{1-\alpha}\frac{\sigma_{treat}}{\sigma_{prior}}-\frac{(d-\delta^*)}{\sigma_{prior}}-\frac{\sigma_{treat}}{\sigma_{prior}}\Phi^{-1}(y) \right)\left[ \phi\left(\Phi^{-1}(y) \right) \right]^{-1},
\end{aligned}
\]</span> see <span class="citation" data-cites="Rufibach2016">[<a href="references.html#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>.</p>
<hr>
<p><strong>Special case</strong></p>
<p>For the case that <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\begin{aligned}
f(y)&amp;=\sqrt{\frac{m}{n}}\phi\left(\sqrt{\frac{m}{n}}\left[-z_{1-\alpha}-\sqrt{\frac{n}{2\sigma^2}}(d-\delta^*)-\Phi^{-1}(y)\right] \right)\left[ \phi\left(\Phi^{-1}(y) \right) \right]^{-1}, \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We derive the probability densities for the different assumed design priors for the SAFE-SSPE study.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Rufibach 2016: formula (4)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(m <span class="sc">*</span> n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> m <span class="sc">*</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    (sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">sqrt</span>(m <span class="sc">*</span> n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> m <span class="sc">*</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    alpha) <span class="sc">-</span> <span class="fu">sqrt</span>(m)<span class="sc">/</span><span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    delta_star) <span class="sc">-</span> <span class="fu">sqrt</span>(m <span class="sc">*</span> n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> m <span class="sc">*</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    n_0 <span class="sc">*</span> (sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> <span class="fu">qnorm</span>(x)) <span class="sc">*</span> (<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y, <span class="at">type =</span> <span class="st">"Enthusiastic"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">*</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">/</span>sigma_prior) <span class="sc">*</span> (prior_mean <span class="sc">-</span> delta_star) <span class="sc">-</span> (sigma_treat<span class="sc">/</span>sigma_prior) <span class="sc">*</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qnorm</span>(x)) <span class="sc">*</span> (<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type =</span> <span class="st">"Skeptical"</span>))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">*</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">/</span>sigma_prior) <span class="sc">*</span> (prior_mean <span class="sc">-</span> delta_star) <span class="sc">-</span> (sigma_treat<span class="sc">/</span>sigma_prior) <span class="sc">*</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qnorm</span>(x)) <span class="sc">*</span> (<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type =</span> <span class="st">"Informative"</span>))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">*</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">/</span>sigma_prior) <span class="sc">*</span> (prior_mean <span class="sc">-</span> delta_star) <span class="sc">-</span> (sigma_treat<span class="sc">/</span>sigma_prior) <span class="sc">*</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qnorm</span>(x)) <span class="sc">*</span> (<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type =</span> <span class="st">"Noninformative"</span>))</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> data_output <span class="sc">%&gt;%</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(type, <span class="at">x =</span> AP) <span class="sc">%&gt;%</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="dv">0</span>)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_power<span class="sc">$</span>type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Enthusiastic"</span>,</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Skeptical"</span>, <span class="st">"Informative"</span>, <span class="st">"Noninformative"</span>))</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_power, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> type)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_output2, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="st">"Prior type"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>,</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"blue"</span>, <span class="st">"darkred"</span>)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"RPR"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Dots indicate the calculated AP."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>The cdf of <span class="math inline">\(RPR\)</span> is</p>
<p><span class="math display">\[
\begin{aligned}
P(RPR\leq y)=1-\Phi&amp;\left(\frac{\sigma_{treat}}{\sigma_{prior}}\left[-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}-\Phi^{-1}(y) \right]\right), \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr>
<p><strong>Special case</strong></p>
<p>For the case that <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\begin{aligned}
P(RPR\leq y)=1-\Phi&amp;\left(\frac{\sigma_{treat}}{\sigma_{prior}}\left[-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}-\Phi^{-1}(y) \right] \right), \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr>
<p>Note that if <span class="math inline">\(n_0\)</span> and <span class="math inline">\(n_1\)</span> are the planned treatment arm sample sizes from a frequentist power calculation as described in <a href="###-frequentist-approach">Section 2.1.1</a> above, then, if <span class="math inline">\(d=\delta_A\)</span>, <span class="math display">\[
-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}=\Phi^{-1}(y)=\Phi^{-1}(1-\beta) \quad \Rightarrow \quad P(RPR\leq y)=0.5, \quad y=1-\beta.
\]</span></p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>With the formula above we can calculate the probability <span class="math inline">\(P(RPR&gt;\gamma)\)</span>, <span class="math inline">\(0&lt;\gamma&lt;1\)</span>, for the SAFE-SSPE study and the above specified design priors.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gamma range</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>, <span class="fl">0.01</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on p1-p0</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">6.6</span>, <span class="dv">25</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> n_0</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, m_range, n_0_range)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gamma"</span>, <span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a <span class="sc">*</span> data_rpr<span class="sc">$</span>n_0_range</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_0_range <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_1_range)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior <span class="sc">-</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior) <span class="sc">*</span> (prior_mean <span class="sc">-</span> delta_star) <span class="sc">-</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>      (data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior) <span class="sc">*</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qnorm</span>(data_rpr<span class="sc">$</span>gamma))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range <span class="sc">==</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Noninformative"</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range <span class="sc">==</span> <span class="fl">6.6</span>] <span class="ot">&lt;-</span> <span class="st">"Enthusiastic"</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range <span class="sc">==</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">"Informative"</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on noninferiority margin</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> n_0</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>data_rpr_skep <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, m_range, n_0_range)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr_skep) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gamma"</span>, <span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a <span class="sc">*</span> data_rpr_skep<span class="sc">$</span>n_0_range</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_0_range <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_1_range)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range <span class="sc">+</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                               data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="sc">-</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior) <span class="sc">*</span> (prior_mean <span class="sc">-</span> delta_star) <span class="sc">-</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    (data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior) <span class="sc">*</span> <span class="fu">qnorm</span>(data_rpr_skep<span class="sc">$</span>gamma))</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Skeptical"</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_rpr, data_rpr_skep)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_rpr<span class="sc">$</span>type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Enthusiastic"</span>,</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Skeptical"</span>, <span class="st">"Informative"</span>, <span class="st">"Noninformative"</span>))</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rpr, <span class="fu">aes</span>(<span class="at">x =</span> gamma, <span class="at">y =</span> p_rpr, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="st">"Prior type"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>,</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"blue"</span>, <span class="st">"darkred"</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Calculated based on a planned total sample size of "</span>,</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>(n_0_range <span class="sc">+</span> a <span class="sc">*</span> n_0_range, <span class="dv">0</span>), <span class="st">"."</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Threshold gamma"</span>) <span class="sc">+</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Probability that RPR is greater than threshold gamma"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For a specific threshold, say <span class="math inline">\(\gamma=0.6\)</span>, and varying ‘prior sample sizes’ <span class="math inline">\(m\)</span> we obtain</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on p1-p0</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">6.6</span>, <span class="dv">25</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(m_range, n_0_range)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a <span class="sc">*</span> data_rpr<span class="sc">$</span>n_0_range</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_0_range <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_1_range)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior <span class="sc">*</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">-</span> (<span class="dv">1</span><span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_treat) <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        delta_star) <span class="sc">-</span> <span class="fu">qnorm</span>(gamma)))</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range <span class="sc">==</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Noninformative"</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range <span class="sc">==</span> <span class="fl">6.6</span>] <span class="ot">&lt;-</span> <span class="st">"Enthusiastic"</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range <span class="sc">==</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">"Informative"</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on noninferiority margin</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>data_rpr_skep <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(m_range, n_0_range)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr_skep) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a <span class="sc">*</span> data_rpr_skep<span class="sc">$</span>n_0_range</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_0_range <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_1_range)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="sc">*</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">-</span> (<span class="dv">1</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_treat) <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        delta_star) <span class="sc">-</span> <span class="fu">qnorm</span>(gamma)))</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Skeptical"</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_rpr, data_rpr_skep)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_rpr<span class="sc">$</span>type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Enthusiastic"</span>,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Skeptical"</span>, <span class="st">"Informative"</span>, <span class="st">"Noninformative"</span>))</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rpr, <span class="fu">aes</span>(<span class="at">x =</span> n_1_range <span class="sc">+</span> n_0_range, <span class="at">y =</span> p_rpr, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="st">"Prior type"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"blue"</span>, <span class="st">"darkred"</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Planned total sample size"</span>) <span class="sc">+</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">str_glue</span>(<span class="st">"Probability that RPR is greater than "</span>, gamma <span class="sc">*</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        <span class="dv">100</span>, <span class="st">"%"</span>)) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>, <span class="dv">400</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">400</span>)) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">200</span>,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Note that the average power AP integrates over the whole <span class="math inline">\(\Delta\)</span> range. This might include also ‘non-favorable’ regions. To see that one can decompose AP as follows (see <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>, <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">4</a>]</span>): <span class="math display">\[
AP=\overbrace{P(D\leq D_{suc}^{\delta^*}, \Delta&gt;\delta^*)}^{(1)}+\overbrace{P(D\leq D_{suc}^{\delta^*}, 0&lt;\Delta\leq\delta^*)}^{(2)}+\overbrace{P(D\leq D_{suc}^{\delta^*}, \Delta\leq0)}^{(3)}
\]</span> where</p>
<ul>
<li><span class="math inline">\((1)\)</span> Probability of Type-I error,</li>
<li><span class="math inline">\((2)\)</span> ‘Non-inferior region, but treatment effect not relevant’,</li>
<li><span class="math inline">\((3)\)</span> ‘Non-inferior region, treatment effect relevant’.</li>
</ul>
<p>Spiegelhalter et al.&nbsp;highlight that <span class="math inline">\(AP \approx P(D\leq D_{suc}^{\delta^*}, \Delta\leq0)\)</span> because the type-I error is often small and one has strong believe for the alternative hypothesis in designing a clinical trial <span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span>. <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span> and <span class="citation" data-cites="OHagan2005">[<a href="references.html#ref-OHagan2005" role="doc-biblioref">5</a>]</span> discuss the practical relevance of the AP decomposition. For example, pharmaceutical companies might favour (1)+(2)+(3) taking into account shortterm risk, wheras regulators are interested in (3) or (2)+(3), that is non-inferior outcomes (2)+(3) with relevant treatment effects (3).</p>
<p>In the non-inferiority setting we are interested in (2)+(3), that is <span class="math inline">\(\Delta\leq\delta^*\)</span>:</p>
<p><span class="math display">\[
P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)=P(D\leq D_{suc}^{\delta^*}|\Delta\leq\delta^*)P(\Delta\leq\delta^*)=\underbrace{E\left[P_{\Delta\leq\delta^*}(D\leq D_{suc}^{\delta^*})\right]}_{EP}P(\Delta\leq\delta^*),
\]</span> Kunzmann et al.&nbsp;denote EP the <strong>‘expected power’</strong> <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>. Note that <span class="math display">\[
\underbrace{P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)}_{PAP}=\underbrace{E\left[P_{\Delta\leq\delta^*}(D\leq D_{suc}^{\delta^*})\right]}_{EP}\underbrace{P(\Delta\leq\delta^*)}_{constant}.
\]</span> Spiegelhalter calls <span class="math inline">\(P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)\)</span> the <strong>‘prior adjusted power’</strong> (PAP).</p>
<p>The AP decomposition can be visualised using the posterior predictive distribution. Let <span class="math inline">\(f(\tilde\delta)\)</span> be the pdf of the posterior predictive distribution then joint distribution of <span class="math inline">\(\tilde\delta\)</span> and <span class="math inline">\(\delta\)</span> is <span class="math display">\[
f_2(\tilde\delta, \delta)= N_2\left(\begin{pmatrix} d \\ d \end{pmatrix}, \begin{pmatrix} \sigma^2_{treat}+\sigma^2_{prior} \quad \sigma^2_{prior} \\ \quad \quad \sigma^2_{prior} \quad \ \quad  \sigma^2_{prior}\end{pmatrix}\right),
\]</span> see formula (2.11) in <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">4</a>]</span>.</p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>For the SAFE-SSPE study the joint distribution <span class="math inline">\(f_2(\tilde\delta, \delta)\)</span> under an enthusiastic prior can be plotted as:</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>sigma_sim <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1 <span class="sc">+</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m), (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m, (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rmvnorm</span>(<span class="at">n =</span> <span class="dv">10000</span>, <span class="at">mean =</span> <span class="fu">c</span>(prior_mean,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    prior_mean), sigma_sim))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_sim) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"delta_pred"</span>, <span class="st">"delta"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred <span class="sc">&lt;=</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> <span class="fu">sqrt</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1 <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0) <span class="sc">-</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        (prior_mean <span class="sc">-</span> delta_star), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta <span class="sc">&lt;=</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    delta_star <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    alpha) <span class="sc">*</span> <span class="fu">sqrt</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1 <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0) <span class="sc">-</span> (prior_mean <span class="sc">-</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    delta_star), <span class="dv">2</span>, data_sim<span class="sc">$</span>region)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta <span class="sc">&gt;</span> delta_star <span class="sc">&amp;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    data_sim<span class="sc">$</span>delta_pred <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> <span class="fu">sqrt</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1 <span class="sc">+</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0) <span class="sc">-</span> (prior_mean <span class="sc">-</span> delta_star), <span class="dv">3</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    data_sim<span class="sc">$</span>region)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_sim<span class="sc">$</span>region, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"'Not significant'"</span>, <span class="st">"(3)"</span>, <span class="st">"(2)"</span>, <span class="st">"(1)"</span>))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_sim, <span class="fu">aes</span>(<span class="at">x =</span> delta, <span class="at">y =</span> delta_pred, <span class="at">colour =</span> <span class="fu">factor</span>(region))) <span class="sc">+</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.035</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> <span class="fu">sqrt</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1 <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0) <span class="sc">-</span> (prior_mean <span class="sc">-</span> delta_star), <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Predictive distribution of Delta"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Delta"</span>) <span class="sc">+</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="st">"Region"</span>, <span class="at">palette =</span> <span class="st">"Reds"</span>) <span class="sc">+</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.035</span>,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Dashed line: Noninferiority margin.</span><span class="sc">\n</span><span class="st">Dotted line: Upper CI from predicted delta &lt;= non-inferiority margin."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig9-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data_sim <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="fu">nrow</span>(data_sim)))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>data_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             region   prop
1 'Not significant' 0.4148
2               (3) 0.4909
3               (2) 0.0920
4               (1) 0.0023</code></pre>
</div>
</div>
<p>From the above values the average power can be calculated as (1) 0.0023 + (2) 0.092 + (3) 0.4909, which is equal to 0.5852. This is the value we reported above (59%).</p>
<p>The results of EP, PAP and AP are shown in the table below:</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sd_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">-</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> n_1)<span class="sc">/</span><span class="fu">sqrt</span>((n_0 <span class="sc">*</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (draws <span class="sc">-</span> delta_star))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ep =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span> delta_star]),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pap =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span> delta_star]) <span class="sc">*</span> <span class="fu">pnorm</span>(delta_star,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior), <span class="at">ap =</span> <span class="fu">mean</span>(power_classic),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">const =</span> <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Skeptical"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">-</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> n_1)<span class="sc">/</span><span class="fu">sqrt</span>((n_0 <span class="sc">*</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (draws <span class="sc">-</span> delta_star))</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    delta_star]), <span class="at">pap =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span> delta_star]) <span class="sc">*</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior), <span class="at">ap =</span> <span class="fu">mean</span>(power_classic),</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">const =</span> <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior),</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Enthusiastic"</span>))</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">-</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> n_1)<span class="sc">/</span><span class="fu">sqrt</span>((n_0 <span class="sc">*</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (draws <span class="sc">-</span> delta_star))</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    delta_star]), <span class="at">pap =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span> delta_star]) <span class="sc">*</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior), <span class="at">ap =</span> <span class="fu">mean</span>(power_classic),</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">const =</span> <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior),</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Informative"</span>))</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e+05</span>, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fl">0.5</span>))</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">-</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> n_1)<span class="sc">/</span><span class="fu">sqrt</span>((n_0 <span class="sc">*</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (draws <span class="sc">-</span> delta_star))</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    delta_star]), <span class="at">pap =</span> <span class="fu">mean</span>(power_classic[draws <span class="sc">&lt;=</span> delta_star]) <span class="sc">*</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior), <span class="at">ap =</span> <span class="fu">mean</span>(power_classic),</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">const =</span> <span class="fu">pnorm</span>(delta_star, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> sd_prior),</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Noninformative"</span>))</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>ep <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>ep, <span class="dv">4</span>)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>ap <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>ap, <span class="dv">4</span>)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>pap <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>pap, <span class="dv">4</span>)</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>const <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>const, <span class="dv">4</span>)</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>data_ep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      ep    pap     ap  const           type
1 0.7930 0.5857 0.5872 0.7386      Skeptical
2 0.6740 0.3370 0.3437 0.5000   Enthusiastic
3 0.7930 0.5857 0.5872 0.7386    Informative
4 0.9186 0.6785 0.5233 0.7386 Noninformative</code></pre>
</div>
</div>
<hr>
</section>
<section id="bayesian-approach-prior-on-the-risk-difference" class="level4" data-number="2.2.1.3">
<h4 data-number="2.2.1.3" class="anchored" data-anchor-id="bayesian-approach-prior-on-the-risk-difference"><span class="header-section-number">2.2.1.3</span> Bayesian approach: Prior on the risk difference</h4>
<p>In this section we use a proper Bayesian approach for the calculation of the probability to reject the null hypothesis <span class="math inline">\(H_0: \delta&gt;\delta^*\)</span>, where <span class="math inline">\(\delta=p_1-p_0\)</span> (<span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span>, <span class="citation" data-cites="Muirhead2013">[<a href="references.html#ref-Muirhead2013" role="doc-biblioref">8</a>]</span>). Suppose that <span class="math inline">\(\Delta \sim N(d, \sigma^2_{prior})\)</span> is an analysis prior for the treatment effect <span class="math inline">\(\delta\)</span>. Remember that <span class="math inline">\(D=\overline{p}_1-\overline{p}_0\)</span> is the estimated (observed) treatment effect with <span class="math inline">\(D \sim N(\delta, \sigma^2_{treat})\)</span>. A ‘trial success’ can then be defined as <span class="math display">\[
P(\Delta\leq\delta^*|D)&gt;1-\epsilon,
\]</span> where <span class="math inline">\(\epsilon\)</span> is small, say <span class="math inline">\(\epsilon=0.05\)</span> (<span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span>, <span class="citation" data-cites="Muirhead2013">[<a href="references.html#ref-Muirhead2013" role="doc-biblioref">8</a>]</span>). Using the above specified prior and likelihood of the data, the posterior distribution is given as <span class="math display">\[
\begin{aligned}
\Delta|D \sim N\left(\frac{\frac{d}{\sigma^2_{prior}}+\frac{D}{\sigma^2_{treat}}}{\frac{1}{\sigma^2_{prior}}+\frac{1}{\sigma^2_{treat}}}, \frac{1}{\frac{1}{\sigma^2_{prior}}+\frac{1}{\sigma^2_{treat}}}\right)=N\left( \frac{\sigma^2_{treat}d+\sigma^2_{prior}D}{\sigma^2_{treat}+\sigma^2_{prior}}, \frac{\sigma^2_{treat}\sigma^2_{prior}}{\sigma^2_{treat}+\sigma^2_{prior}}  \right),
\end{aligned}
\]</span> see for example <span class="citation" data-cites="Gelman2013">[<a href="references.html#ref-Gelman2013" role="doc-biblioref">7</a>]</span>.</p>
<hr>
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\Delta|D \sim N\left(\frac{m\delta+nD}{n+m}, \frac{2\sigma^2}{n+m} \right).
\]</span></p>
<hr>
<p>The trial is successful if <span class="math display">\[
\frac{\sigma^2_{treat}d+\sigma^2_{prior}D}{\sigma^2_{treat}+\sigma^2_{prior}}+z_{1-\epsilon}\frac{\sigma_{treat}\sigma_{prior}}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\leq \delta^*,
\]</span> where the left side of the above equation is the upper <span class="math inline">\((1-\epsilon)\)</span>-credible interval. A simple algebraic step gives <span class="math display">\[
\begin{aligned}
D\leq -z_{1-\epsilon}&amp;\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d.
\end{aligned}
\]</span> Here, <span class="math inline">\(D_{suc}^{d,\delta^*}=-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d\)</span> is the <strong>required risk difference</strong> for a successful rejection of the null hypothesis taking into account the uncertainty of <span class="math inline">\(\delta\)</span>.</p>
<p>Since <span class="math inline">\(D\sim N(\delta, \sigma_{treat}^2)\)</span>, <span class="math display">\[
\begin{aligned}
P(D\leq D_{suc}^{d,\delta^*}|\delta)&amp;=\Phi\left(-z_{1-\epsilon}\sqrt{1+\frac{\sigma^2_{treat}}{\sigma_{prior}^2}}-\frac{1}{\sigma_{treat}}\left[\delta-\delta^*\left\{ 1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2} \right\} \right]-\frac{\sigma_{treat}}{\sigma_{prior}^2}d \right).
\end{aligned}
\]</span> This is the <strong>conditional Bayesian probability to reject</strong> (or Bayesian power) under an (assumed) <em>known</em> true treatment effect <span class="math inline">\(\delta\)</span>.</p>
<hr>
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to <span class="math display">\[
\begin{aligned}
P(D\leq D_{suc}^{d,\delta^*}|\delta)&amp;=\Phi\left(-z_{1-\epsilon}\sqrt{\frac{n+m}{n}}- \frac{m}{\sqrt{2n\sigma^2}}d-\sqrt{\frac{n}{2n\sigma^2}}\left\{\delta-\delta^*\left(\frac{n+m}{n} \right)\right\} \right).
\end{aligned}
\]</span></p>
<hr>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We derive the conditional Bayesian probability to reject for the SAFE-SSPE study for different <span class="math inline">\(\delta\)</span> values and analysis priors.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Delta range</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Epsilon</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> epsilon) <span class="sc">*</span> (<span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> m <span class="sc">*</span> (n_0 <span class="sc">*</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))) <span class="sc">-</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    (m <span class="sc">*</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0) <span class="sc">*</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> prior_mean <span class="sc">-</span> <span class="fu">sqrt</span>((n_1 <span class="sc">*</span> n_0)<span class="sc">/</span>((n_0 <span class="sc">*</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> (delta <span class="sc">-</span> delta_star <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (m <span class="sc">*</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    (n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(delta, <span class="at">y =</span> ap_bayes, <span class="at">type =</span> <span class="st">"Bayes: Enthusiastic"</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> epsilon) <span class="sc">*</span> (<span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> m <span class="sc">*</span> (n_0 <span class="sc">*</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))) <span class="sc">-</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    (m <span class="sc">*</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0) <span class="sc">*</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> prior_mean <span class="sc">-</span> <span class="fu">sqrt</span>((n_1 <span class="sc">*</span> n_0)<span class="sc">/</span>((n_0 <span class="sc">*</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> (delta <span class="sc">-</span> delta_star <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (m <span class="sc">*</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    (n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y =</span> ap_bayes,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Bayes: Skeptical"</span>))</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> epsilon) <span class="sc">*</span> (<span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> m <span class="sc">*</span> (n_0 <span class="sc">*</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))) <span class="sc">-</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    (m <span class="sc">*</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0) <span class="sc">*</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> prior_mean <span class="sc">-</span> <span class="fu">sqrt</span>((n_1 <span class="sc">*</span> n_0)<span class="sc">/</span>((n_0 <span class="sc">*</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> (delta <span class="sc">-</span> delta_star <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (m <span class="sc">*</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    (n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y =</span> ap_bayes,</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Bayes: Informative"</span>))</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> epsilon) <span class="sc">*</span> (<span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> m <span class="sc">*</span> (n_0 <span class="sc">*</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))) <span class="sc">-</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    (m <span class="sc">*</span> <span class="fu">sqrt</span>(n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0) <span class="sc">*</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>        (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> prior_mean <span class="sc">-</span> <span class="fu">sqrt</span>((n_1 <span class="sc">*</span> n_0)<span class="sc">/</span>((n_0 <span class="sc">*</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">*</span> (delta <span class="sc">-</span> delta_star <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (m <span class="sc">*</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    (n_0 <span class="sc">*</span> sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1 <span class="sc">*</span> n_0 <span class="sc">*</span> (sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y =</span> ap_bayes,</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Bayes: Noninformative"</span>))</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequentist</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>y_freq <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span>(delta <span class="sc">-</span> delta_star) <span class="sc">*</span> <span class="fu">sqrt</span>(n_1 <span class="sc">*</span> n_0)<span class="sc">/</span><span class="fu">sqrt</span>(n_0 <span class="sc">*</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    sd_1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n_1 <span class="sc">*</span> sd_0<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha))</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y =</span> y_freq,</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Frequentist"</span>))</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_power<span class="sc">$</span>type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Bayes: Enthusiastic"</span>,</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bayes: Skeptical"</span>, <span class="st">"Bayes: Informative"</span>, <span class="st">"Bayes: Noninformative"</span>,</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Frequentist"</span>))</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_power, <span class="fu">aes</span>(<span class="at">x =</span> delta, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="st">"Type"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>,</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"blue"</span>, <span class="st">"darkred"</span>, <span class="st">"green"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Probability to reject"</span>) <span class="sc">+</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Probability to reject"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.025</span>,</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.05</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>,</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.8</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.035</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption=</span><span class="fu">str_glue</span>(<span class="st">"For treatment arm sample sizes: n0="</span>,</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(n_0, <span class="dv">0</span>), <span class="st">", n1="</span>, <span class="fu">round</span>(n_1, <span class="dv">0</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig11-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">round</span>(data_power<span class="sc">$</span>y, <span class="dv">2</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>data_power <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(delta <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"0.035"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   delta    y                  type
1  0.000 0.83   Bayes: Enthusiastic
2  0.035 0.06   Bayes: Enthusiastic
3  0.000 0.78      Bayes: Skeptical
4  0.035 0.04      Bayes: Skeptical
5  0.000 0.90    Bayes: Informative
6  0.035 0.11    Bayes: Informative
7  0.000 0.80 Bayes: Noninformative
8  0.035 0.05 Bayes: Noninformative
9  0.000 0.80           Frequentist
10 0.035 0.05           Frequentist</code></pre>
</div>
</div>
<p>The Bayesian probability to reject <span class="math inline">\(H_0: \delta&gt;\delta^*\)</span> given <span class="math inline">\(\delta=p_1-p_0=0\)</span> and an informative prior is 90%. This is higher than the frequentist probability to reject of 80% given <span class="math inline">\(\delta=p_1-p_0=0\)</span>. In contrast, the probability to reject <span class="math inline">\(H_0: \delta&gt;\delta^*\)</span> for <span class="math inline">\(\delta=0.035\)</span> under an informative prior is 11%. This is higher than the frequentist ‘type-I error’ of 5%. The probability to reject under the null hypothesis is higher for the Bayesian approach under an informative prior because the prior has substantial believe in non-inferiority.</p>
<hr>
<p>Suppose <span class="math inline">\(\tilde D\)</span> is calculated from a future sample given we have already observed <span class="math inline">\(D\)</span>. The posterior predictive distribution of <span class="math inline">\(\tilde D\)</span> is Gaussian distributed <span class="math inline">\(\tilde D \sim N(d, \sigma_{treat}^2+\sigma_{prior}^2)\)</span> under an analysis prior <span class="math inline">\(\Delta \sim N(d, \sigma^2_{prior})\)</span>. The <strong>Bayesian average (marginal) probability to reject</strong> (BAP) can be calculated as <span class="math display">\[
\begin{aligned}
BAP&amp;=\int_{-\infty}^{-\infty}P(D\leq D_{suc}^{d,\delta^*}|\delta)f(\delta)d\delta\\
&amp;=\int_{-\infty}^{-\infty}\left\{\int_{-\infty}^{-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d}f(\tilde \delta| \delta)d\tilde \delta \right\}f(\delta)d\delta\\
&amp;=\int_{-\infty}^{-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d} \left\{\int_{-\infty}^{-\infty}f(\tilde \delta| \delta)f(\delta)d\delta \right\}d\tilde \delta\\
&amp;=\int_{-\infty}^{-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d} f(\tilde \delta)d\tilde \delta
\\&amp;=\Phi\left( -z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\frac{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}+\frac{\delta^*}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\left\{1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right\} \right. \\
  &amp; \left. \quad \quad \quad-\frac{d}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\left\{1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right\}\right) \\
&amp;=\Phi\left(-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}-\frac{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}{\sigma^2_{prior}}(d-\delta^*)\right).
\end{aligned}
\]</span></p>
<hr>
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to <span class="math display">\[
\begin{aligned}
BAP&amp;=-z_{1-\epsilon}\sqrt{\frac{m}{n}}-\sqrt{\frac{(m+n)m}{2n\sigma^2}}(d-\delta^*)
\end{aligned}
\]</span></p>
<hr>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We derive the Bayesian average probability to reject for the SAFE-SSPE study.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Hybrid AP</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>digit_round <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Enthusiastic"</span>, n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    digit_round))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Skeptical"</span>,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP, digit_round)))</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Informative"</span>,</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP, digit_round)))</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior <span class="sc">*</span> (<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat <span class="sc">-</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    (prior_mean <span class="sc">-</span> delta_star)))</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Noninformative"</span>,</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP =</span> <span class="fu">round</span>(AP, digit_round)))</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> data_output <span class="sc">%&gt;%</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(type, n_0, n_1, AP)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="do">### Bayesian AP</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0 <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>        delta_star))</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Enthusiastic"</span>, n_0, n_1, <span class="at">AP_bayes =</span> <span class="fu">round</span>(ap_bayes,</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    digit_round))</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>        delta_star))</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Skeptical"</span>,</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP_bayes =</span> <span class="fu">round</span>(ap_bayes, digit_round)))</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>        delta_star))</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Informative"</span>,</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP_bayes =</span> <span class="fu">round</span>(ap_bayes, digit_round)))</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> sigma_treat<span class="sc">/</span>sigma_prior <span class="sc">-</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (prior_mean <span class="sc">-</span></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>        delta_star))</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Noninformative"</span>,</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>    n_0, n_1, <span class="at">AP_bayes =</span> <span class="fu">round</span>(ap_bayes, digit_round)))</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data_output, data_output2 <span class="sc">%&gt;%</span></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(type, AP_bayes), <span class="at">by =</span> <span class="st">"type"</span>)</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>data_output <span class="sc">%&gt;%</span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(type, n_0, n_1, <span class="at">AP_hybrid =</span> AP, AP_bayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            type      n_0      n_1 AP_hybrid AP_bayes
1   Enthusiastic 99.93031 99.93031    0.5856   0.5937
2      Skeptical 99.93031 99.93031    0.3363   0.3363
3    Informative 99.93031 99.93031    0.6631   0.7149
4 Noninformative 99.93031 99.93031    0.5237   0.5239</code></pre>
</div>
</div>
<p>The average Bayesian power under an informative prior is 72% compared to 66% from a hybrid approach.</p>
<hr>
</section>
<section id="hybrid-approach-prior-on-event-probabilities" class="level4" data-number="2.2.1.4">
<h4 data-number="2.2.1.4" class="anchored" data-anchor-id="hybrid-approach-prior-on-event-probabilities"><span class="header-section-number">2.2.1.4</span> Hybrid approach: Prior on event probabilities</h4>
<p>In the former subsections we assumed that the prior was directly specified on the treatment effect <span class="math inline">\(\delta\)</span>. In this subsection design priors are specified on the event probabilities <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i=\{0,1\}\)</span>. Suppose that these design priors are beta distributed <span class="math inline">\(\pi_i \sim Beta(a_i,b_i)\)</span>, <span class="math inline">\(i=\{0,1\}\)</span>. It is well known (see for example <span class="citation" data-cites="Gelman2013">[<a href="references.html#ref-Gelman2013" role="doc-biblioref">7</a>]</span>) that the prior predictive distribution of the number of events <span class="math inline">\(R_i\)</span>, <span class="math inline">\(i=\{0,1\}\)</span>, from a future binomial sample of size <span class="math inline">\(n_i\)</span>, <span class="math inline">\(i=\{0,1\}\)</span>, is beta-binomial distributed <span class="math inline">\(R_i \sim betabinom(r_i|n_i, a_i, b_i)\)</span> with <span class="math display">\[
E(R_i)=n_i\frac{a_i}{a_i+b_i}, \quad Var(R_i)=\frac{n_ia_ib_i(n_i+a_i+b_i)}{(a_i+b_i)^2(a_i+b_i+1)}.
\]</span></p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>For the SAFE-SSPE trial we specify the following design beta priors for the expected event probabilites <span class="math inline">\(p_1=p_0=0.01\)</span>.</p>
<p><strong>Enthusiastic prior</strong>: The beta prior for the active treatment arm is centered at 0.01 (the expected event proportion) with <span class="math inline">\(P(\pi_1&gt; 0.05)=0.025\)</span>, that is, the probability that the prior is greater than the safety margin is 2.5%. The mean of the beta prior for the control arm is centered at 0.03 (the safety margin) with <span class="math inline">\(P(\pi_0&gt; 0.05)=0.05\)</span>.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=0.5\)</span>, <span class="math inline">\(b_1=49.5\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_0=7.2\)</span>, <span class="math inline">\(b_0=232.8\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extraDistr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Enthusiastic prior</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">7.2</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>)<span class="sc">/</span><span class="fl">0.03</span> <span class="sc">*</span> a_0</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    prior_1))</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_0"</span>) <span class="sc">==</span> T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> group)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Enthusiastic prior"</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>diff_prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1),</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    a_1, b_1)<span class="sc">/</span><span class="fu">ceiling</span>(n_1) <span class="sc">-</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0),</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    a_0, b_0)<span class="sc">/</span><span class="fu">ceiling</span>(n_0))</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diff_prior, <span class="fu">aes</span>(x), <span class="at">group =</span> x) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">bw =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Difference from simulated predicted event probabilities"</span>) <span class="sc">+</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Distribution of difference from</span><span class="sc">\n</span><span class="st">simulated predicted event proportions"</span>) <span class="sc">+</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> delta_star,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fl">0.25</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.25</span>,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(fig1, fig2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Skeptical prior</strong>: The beta prior for the active treatment arm is centered at 0.05 (the safety margin) with <span class="math inline">\(P(\pi_1\leq 0.01)=0.025\)</span>, that is the probability that the prior is smaller or equal than the expected event proportion is 2.5%. The mean of the beta prior for the control arm is is centered at 0.01 (the expected event proportion) with <span class="math inline">\(P(\pi_0&gt; 0.05)=0.025\)</span>.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=2.84\)</span>, <span class="math inline">\(b_1=53.96\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_i=1.24\)</span>, <span class="math inline">\(b_i=122.76\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">2.84</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">/</span><span class="fl">0.05</span> <span class="sc">*</span> a_1</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">1.24</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.01</span>)<span class="sc">/</span><span class="fl">0.01</span> <span class="sc">*</span> a_0</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    prior_1))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_0"</span>) <span class="sc">==</span> T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> group)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Skeptical prior"</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>diff_prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    a_1, b_1)<span class="sc">/</span><span class="fu">ceiling</span>(n_1) <span class="sc">-</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0),</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    a_0, b_0)<span class="sc">/</span><span class="fu">ceiling</span>(n_0))</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diff_prior, <span class="fu">aes</span>(x), <span class="at">group =</span> x) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">bw =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Difference from simulated predicted event probabilities"</span>) <span class="sc">+</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Distribution of difference from</span><span class="sc">\n</span><span class="st">simulated predicted event proportions"</span>) <span class="sc">+</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> delta_star,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fl">0.25</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.25</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(fig1, fig2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Informative prior</strong>: The beta prior for the active treatment arm and control arm is centered at 0.01 (the expected event proportion) with <span class="math inline">\(P(\pi_1\leq 0.05)=0.01\)</span> and <span class="math inline">\(P(\pi_1\leq 0.05)=0.05\)</span>.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=0.8\)</span>, <span class="math inline">\(b_1=79.2\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_0=0.03\)</span>, <span class="math inline">\(b_0=2.97\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Informative prior</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    prior_1))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_0"</span>) <span class="sc">==</span> T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> group)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Informative prior"</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>diff_prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1),</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    a_1, b_1)<span class="sc">/</span><span class="fu">ceiling</span>(n_1) <span class="sc">-</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0),</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    a_0, b_0)<span class="sc">/</span><span class="fu">ceiling</span>(n_0))</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diff_prior, <span class="fu">aes</span>(x), <span class="at">group =</span> x) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">bw =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Difference from simulated predicted event probabilities"</span>) <span class="sc">+</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Distribution of difference from</span><span class="sc">\n</span><span class="st">simulated predicted event proportions"</span>) <span class="sc">+</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> delta_star,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fl">0.25</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.25</span>,</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(fig1, fig2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Noninformative prior</strong>: Agresti and Min suggest to use a ‘diffuse’ prior and recommend to use Jeffrey’s prior <span class="citation" data-cites="Agresti2005">[<a href="references.html#ref-Agresti2005" role="doc-biblioref">9</a>]</span>. Jeffrey’s prior for a binomial likelihood is <span class="math inline">\(beta(0.5, 0.5)\)</span>-distributed.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=0.5\)</span>, <span class="math inline">\(b_1=0.5\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_0=0.5\)</span>, <span class="math inline">\(b_0=0.5\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Noninformative prior</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    prior_1))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_0"</span>) <span class="sc">==</span> T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> group)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Noninformative prior"</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>diff_prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    a_1, b_1)<span class="sc">/</span><span class="fu">ceiling</span>(n_1) <span class="sc">-</span> <span class="fu">rbbinom</span>(<span class="fl">1e+06</span>, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    a_0, b_0)<span class="sc">/</span><span class="fu">ceiling</span>(n_0))</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diff_prior, <span class="fu">aes</span>(x), <span class="at">group =</span> x) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">bw =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Difference from simulated predicted event probabilities"</span>) <span class="sc">+</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Distribution of difference from</span><span class="sc">\n</span><span class="st">simulated predicted event proportions"</span>) <span class="sc">+</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> delta_star,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.75</span>, <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fl">0.25</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.75</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.25</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(fig1, fig2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>One can calculate the average power as follows:</p>
<section id="approach-1-joint-prior-predictive-probability" class="level5" data-number="2.2.1.4.1">
<h5 data-number="2.2.1.4.1" class="anchored" data-anchor-id="approach-1-joint-prior-predictive-probability"><span class="header-section-number">2.2.1.4.1</span> Approach 1: Joint prior predictive probability</h5>
<p>The joint probability approach has been described in <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">4</a>]</span> and includes the following steps:</p>
<ul>
<li>Calculate the joint pdf for all pairs <span class="math inline">\(r_i\in\{0, 1, \cdots, n_i\}\)</span>, <span class="math inline">\(i\in\{0,1\}\)</span>.</li>
<li>The sum of the joint predictive probabilites over <span class="math inline">\(r_i\)</span> pairs where the <span class="math inline">\((1-\alpha)\)</span>-upper confidence limit of the risk difference is smaller than the non-inferiority margin is the average power.</li>
</ul>
<p>Here we use Agresti-Caffo confidence intervals for the risk difference <span class="citation" data-cites="Agresti2000">[<a href="references.html#ref-Agresti2000" role="doc-biblioref">10</a>]</span>.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extraDistr)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PropCIs)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Enthusiastic prior</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">7.2</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>)<span class="sc">/</span><span class="fl">0.03</span> <span class="sc">*</span> a_0</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_0)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_1)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>data_points <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">r_1 =</span> r_1, <span class="at">r_0 =</span> r_0)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_1 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_1, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    b_1)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_0 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_0, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    b_0)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>joint_pdf <span class="ot">&lt;-</span> data_points<span class="sc">$</span>pdf_r_1 <span class="sc">*</span> data_points<span class="sc">$</span>pdf_r_0</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_points)) {</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    data_points<span class="sc">$</span>sig[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(data_points<span class="sc">$</span>r_1[i], n_1, data_points<span class="sc">$</span>r_0[i],</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star,</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Enthusiastic"</span>, </span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ap =</span> <span class="fu">sum</span>(data_points<span class="sc">$</span>joint_pdf[data_points<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>]))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Skeptical prior</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">2.84</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">/</span><span class="fl">0.05</span> <span class="sc">*</span> a_1</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">1.24</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.01</span>)<span class="sc">/</span><span class="fl">0.01</span> <span class="sc">*</span> a_0</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_0)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_1)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>data_points <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">r_1 =</span> r_1, <span class="at">r_0 =</span> r_0)</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_1 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_1, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1,</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>    b_1)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_0 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_0, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0,</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    b_0)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>joint_pdf <span class="ot">&lt;-</span> data_points<span class="sc">$</span>pdf_r_1 <span class="sc">*</span> data_points<span class="sc">$</span>pdf_r_0</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_points)) {</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>    data_points<span class="sc">$</span>sig[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(data_points<span class="sc">$</span>r_1[i], n_1, data_points<span class="sc">$</span>r_0[i],</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>        n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star,</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_ap, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Skeptical"</span>, </span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ap =</span> <span class="fu">sum</span>(data_points<span class="sc">$</span>joint_pdf[data_points<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="do">## Informative prior</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_0)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_1)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>data_points <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">r_1 =</span> r_1, <span class="at">r_0 =</span> r_0)</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_1 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_1, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1,</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>    b_1)</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_0 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_0, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0,</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>    b_0)</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>joint_pdf <span class="ot">&lt;-</span> data_points<span class="sc">$</span>pdf_r_1 <span class="sc">*</span> data_points<span class="sc">$</span>pdf_r_0</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_points)) {</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>    data_points<span class="sc">$</span>sig[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(data_points<span class="sc">$</span>r_1[i], n_1, data_points<span class="sc">$</span>r_0[i],</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>        n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star,</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_ap, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Informative"</span>, </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ap =</span> <span class="fu">sum</span>(data_points<span class="sc">$</span>joint_pdf[data_points<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a><span class="do">## Noninformative prior</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_0)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ceiling</span>(n_1)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>data_points <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">r_1 =</span> r_1, <span class="at">r_0 =</span> r_0)</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_1 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_1, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1,</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>    b_1)</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>pdf_r_0 <span class="ot">&lt;-</span> <span class="fu">dbbinom</span>(data_points<span class="sc">$</span>r_0, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0,</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>    b_0)</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>joint_pdf <span class="ot">&lt;-</span> data_points<span class="sc">$</span>pdf_r_1 <span class="sc">*</span> data_points<span class="sc">$</span>pdf_r_0</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>data_points<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_points)) {</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>    data_points<span class="sc">$</span>sig[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(data_points<span class="sc">$</span>r_1[i], n_1, data_points<span class="sc">$</span>r_0[i],</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>        n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star,</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_ap, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Noninformative prior"</span>, </span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ap =</span> <span class="fu">sum</span>(data_points<span class="sc">$</span>joint_pdf[data_points<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>res_ap<span class="sc">$</span>ap <span class="ot">&lt;-</span> <span class="fu">round</span>(res_ap<span class="sc">$</span>ap, <span class="dv">2</span>)</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>res_ap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  type   ap
1         Enthusiastic 0.76
2            Skeptical 0.09
3          Informative 0.55
4 Noninformative prior 0.40</code></pre>
</div>
</div>
</section>
<section id="approach-2-sampling-from-prior-predictive-distribution" class="level5" data-number="2.2.1.4.2">
<h5 data-number="2.2.1.4.2" class="anchored" data-anchor-id="approach-2-sampling-from-prior-predictive-distribution"><span class="header-section-number">2.2.1.4.2</span> Approach 2: Sampling from prior predictive distribution</h5>
<p>The second approach samples <span class="math inline">\(q\)</span> event outcomes from the predictive distribution and calculates for each draw whether the <span class="math inline">\((1-\alpha)\)</span>-upper confidence limit of the risk difference is smaller than the non-inferiority margin. The sum of positive outcomes divided by the number of samples <span class="math inline">\(q\)</span> gives the average power. Also here we use Agresti-Caffo confidence intervals for the risk difference <span class="citation" data-cites="Agresti2000">[<a href="references.html#ref-Agresti2000" role="doc-biblioref">10</a>]</span>.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of draws</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Enthusiastic prior</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">7.2</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>)<span class="sc">/</span><span class="fl">0.03</span> <span class="sc">*</span> a_0</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1, b_1)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0, b_0)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r_1)) {</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(r_1[i], n_1, r_0[i], n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Enthusiastic"</span>, <span class="at">ap =</span> <span class="fu">sum</span>(res)<span class="sc">/</span>q)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Skeptical prior</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">2.84</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">/</span><span class="fl">0.05</span> <span class="sc">*</span> a_1</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">1.24</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1, b_1)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0, b_0)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r_1)) {</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(r_1[i], n_1, r_0[i], n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_ap, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Skeptical"</span>, <span class="at">ap =</span> <span class="fu">sum</span>(res)<span class="sc">/</span>q))</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Informative prior</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1, b_1)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0, b_0)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r_1)) {</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(r_1[i], n_1, r_0[i], n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>,</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_ap, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Informative"</span>, <span class="at">ap =</span> <span class="fu">sum</span>(res)<span class="sc">/</span>q))</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="do">## Noninformative prior</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>r_1 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_1), a_1, b_1)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>r_0 <span class="ot">&lt;-</span> <span class="fu">rbbinom</span>(q, <span class="at">size =</span> <span class="fu">ceiling</span>(n_0), a_0, b_0)</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r_1)) {</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, <span class="fu">ifelse</span>(<span class="fu">wald2ci</span>(r_1[i], n_1, r_0[i], n_0, <span class="at">conf.level =</span> <span class="fl">0.95</span>,</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">adjust =</span> <span class="st">"AC"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>] <span class="sc">&lt;=</span> delta_star, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>res_ap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_ap, <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">"Noninformative"</span>, <span class="at">ap =</span> <span class="fu">sum</span>(res)<span class="sc">/</span>q))</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>res_ap<span class="sc">$</span>ap <span class="ot">&lt;-</span> <span class="fu">round</span>(res_ap<span class="sc">$</span>ap, <span class="dv">2</span>)</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>res_ap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            type   ap
1   Enthusiastic 0.76
2      Skeptical 0.09
3    Informative 0.55
4 Noninformative 0.45</code></pre>
</div>
</div>
</section>
</section>
<section id="bayesian-approach-prior-on-event-probabilities" class="level4" data-number="2.2.1.5">
<h4 data-number="2.2.1.5" class="anchored" data-anchor-id="bayesian-approach-prior-on-event-probabilities"><span class="header-section-number">2.2.1.5</span> Bayesian approach: Prior on event probabilities</h4>
<p>In the former subsection we assumed that the prior was directly specified on the treatment effect. In this subsection we assume that that design prior is specified on the event probabilities <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i=\{0,1\}\)</span>. Suppose that the priors on the event probability are beta distributed <span class="math inline">\(\pi_i \sim Beta(a_i,b_i)\)</span> and that we have observed a binomial distributed random sample of size <span class="math inline">\(n_i\)</span> and number of events <span class="math inline">\(r_i\)</span>. Then the posterior distribution is <span class="math display">\[
p_i|r_i \sim Beta\left(a_i+r_i,b_i+n_i-r_i\right)=\frac{p_i^{a_i+r_i-1}(1-p_i)^{b_i+n_i-r_i-1}}{B(a_i+r_i, b_i+n_i-r_i)}
\]</span> with <span class="math inline">\(B(\cdot)\)</span> the beta function and <span class="math display">\[
\mu_{i,r_i}:=E(p_i|r_i)=\frac{a_i+r_i}{a_i+b_i+n_i}, \quad \sigma_{i,r_i}^2:=Var(p_i|r_i)=\frac{\left(a_i+r_i\right)\left(b_i+n_i-r_i\right)}{(a_i+b_i+n_i)^2(a_i+b_i+n_i+1)}.
\]</span></p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We use the same prior specifications as from the former subsection for the analysis priors.</p>
<p><strong>Enthusiastic prior</strong>: The beta prior for the active treatment arm is centered at 0.01 (the expected event proportion) with <span class="math inline">\(P(\pi_1&gt; 0.05)=0.025\)</span>, that is, the probability that the prior is greater than the safety margin is 2.5%. The mean of the beta prior for the control arm is centered at 0.03 (the safety margin) with <span class="math inline">\(P(\pi_0&gt; 0.05)=0.05\)</span>.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=0.5\)</span>, <span class="math inline">\(b_1=49.5\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_0=7.2\)</span>, <span class="math inline">\(b_0=232.8\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Enthusiastic prior</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">7.2</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>)<span class="sc">/</span><span class="fl">0.03</span> <span class="sc">*</span> a_0</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>posterior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0, b_0 <span class="sc">+</span> n_0 <span class="sc">-</span> n_0 <span class="sc">*</span> p_0)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>posterior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1, b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span> p_1)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>var_posterior_0 <span class="ot">&lt;-</span> ((a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0) <span class="sc">*</span> (b_0 <span class="sc">+</span> n_0 <span class="sc">-</span> n_0 <span class="sc">*</span> p_0))<span class="sc">/</span>((a_0 <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    b_0 <span class="sc">+</span> n_0)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_0 <span class="sc">+</span> b_0 <span class="sc">+</span> n_0 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>var_posterior_1 <span class="ot">&lt;-</span> ((a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1) <span class="sc">*</span> (b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span> p_1))<span class="sc">/</span>((a_1 <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    b_1 <span class="sc">+</span> n_1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_1 <span class="sc">+</span> b_1 <span class="sc">+</span> n_1 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1, posterior_0, posterior_1)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0, prior_1,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    posterior_0, posterior_1))</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name, <span class="st">"posterior"</span>) <span class="sc">==</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    T, <span class="st">"Posterior"</span>, <span class="st">"Prior"</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name, <span class="st">"_0"</span>) <span class="sc">==</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">linetype =</span> type, <span class="at">colour =</span> group)) <span class="sc">+</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"vertical"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")</span><span class="sc">\n</span><span class="st">Posterior standard deviation: Control arm="</span>,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_0), <span class="dv">3</span>), <span class="st">", "</span>, <span class="st">"Active arm="</span>, <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_1),</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>))) <span class="sc">+</span> <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Enthusiastic prior"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Skeptical prior</strong>: The beta prior for the active treatment arm is centered at 0.05 (the safety margin) with <span class="math inline">\(P(\pi_1\leq 0.01)=0.025\)</span>, that is the probability that the prior is smaller or equal than the expected event proportion is 2.5%. The mean of the beta prior for the control arm is is centered at 0.01 (the expected event proportion) with <span class="math inline">\(P(\pi_0&gt; 0.05)=0.025\)</span>.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=2.84\)</span>, <span class="math inline">\(b_1=53.96\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_i=1.24\)</span>, <span class="math inline">\(b_i=122.76\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">2.84</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">/</span><span class="fl">0.05</span> <span class="sc">*</span> a_1</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">1.24</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>posterior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0, b_0 <span class="sc">+</span> n_0 <span class="sc">-</span> n_0 <span class="sc">*</span> p_0)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>posterior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1, b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span> p_1)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>var_posterior_0 <span class="ot">&lt;-</span> ((a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0) <span class="sc">*</span> (b_0 <span class="sc">+</span> n_0 <span class="sc">-</span> n_0 <span class="sc">*</span> p_0))<span class="sc">/</span>((a_0 <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    b_0 <span class="sc">+</span> n_0)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_0 <span class="sc">+</span> b_0 <span class="sc">+</span> n_0 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>var_posterior_1 <span class="ot">&lt;-</span> ((a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1) <span class="sc">*</span> (b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span> p_1))<span class="sc">/</span>((a_1 <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    b_1 <span class="sc">+</span> n_1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_1 <span class="sc">+</span> b_1 <span class="sc">+</span> n_1 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1, posterior_0, posterior_1)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0, prior_1,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    posterior_0, posterior_1))</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name, <span class="st">"posterior"</span>) <span class="sc">==</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    T, <span class="st">"Posterior"</span>, <span class="st">"Prior"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name, <span class="st">"_0"</span>) <span class="sc">==</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">linetype =</span> type, <span class="at">colour =</span> group)) <span class="sc">+</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"vertical"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Expected event probabilities: Control arm (p_0="</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")</span><span class="sc">\n</span><span class="st">Posterior standard deviation: Control arm="</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_0), <span class="dv">3</span>), <span class="st">", "</span>, <span class="st">"Active arm="</span>, <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_1),</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>))) <span class="sc">+</span> <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Skeptical prior"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Informative prior</strong>: The beta prior for the active treatment arm and control arm is centered at 0.01 (the expected event proportion) with <span class="math inline">\(P(\pi_1\leq 0.05)=0.01\)</span> and <span class="math inline">\(P(\pi_1\leq 0.05)=0.05\)</span>.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=0.8\)</span>, <span class="math inline">\(b_1=79.2\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_0=0.03\)</span>, <span class="math inline">\(b_0=2.97\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Informative prior</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>posterior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0, b_0 <span class="sc">+</span> n_0 <span class="sc">-</span> n_0 <span class="sc">*</span> p_0)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>posterior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1, b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span> p_1)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>var_posterior_0 <span class="ot">&lt;-</span> ((a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0) <span class="sc">*</span> (b_0 <span class="sc">+</span> n_0 <span class="sc">-</span> n_0 <span class="sc">*</span> p_0))<span class="sc">/</span>((a_0 <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    b_0 <span class="sc">+</span> n_0)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_0 <span class="sc">+</span> b_0 <span class="sc">+</span> n_0 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>var_posterior_1 <span class="ot">&lt;-</span> ((a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1) <span class="sc">*</span> (b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span> p_1))<span class="sc">/</span>((a_1 <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    b_1 <span class="sc">+</span> n_1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_1 <span class="sc">+</span> b_1 <span class="sc">+</span> n_1 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1, posterior_0, posterior_1)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0, prior_1,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    posterior_0, posterior_1))</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name, <span class="st">"posterior"</span>) <span class="sc">==</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    T, <span class="st">"Posterior"</span>, <span class="st">"Prior"</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name, <span class="st">"_0"</span>) <span class="sc">==</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">linetype =</span> type, <span class="at">colour =</span> group)) <span class="sc">+</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"vertical"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")</span><span class="sc">\n</span><span class="st">Posterior standard deviation: Control arm="</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_0), <span class="dv">3</span>), <span class="st">", "</span>, <span class="st">"Active arm="</span>, <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_1),</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>))) <span class="sc">+</span> <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>, <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Enthusiastic prior"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Noninformative prior</strong>: Agresti and Min suggest to use a ‘diffuse’ prior and recommend to use Jeffrey’s prior <span class="citation" data-cites="Agresti2005">[<a href="references.html#ref-Agresti2005" role="doc-biblioref">9</a>]</span>. Jeffrey’s prior for a binomial likelihood is <span class="math inline">\(beta(0.5, 0.5)\)</span>-distributed.</p>
<ul>
<li>Parameters of beta prior for active treatment arm: <span class="math inline">\(a_1=0.5\)</span>, <span class="math inline">\(b_1=0.5\)</span>.</li>
<li>Parameters of beta prior for control treatment arm: <span class="math inline">\(a_0=0.5\)</span>, <span class="math inline">\(b_0=0.5\)</span>.</li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Noninformative prior</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>prior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0, b_0)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>prior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1, b_1)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>posterior_0 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0, b_0 <span class="sc">+</span> n_0 <span class="sc">-</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    n_0 <span class="sc">*</span> p_0)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>posterior_1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1, b_1 <span class="sc">+</span> n_1 <span class="sc">-</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    n_1 <span class="sc">*</span> p_1)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>var_posterior_0 <span class="ot">&lt;-</span> ((a_0 <span class="sc">+</span> n_0 <span class="sc">*</span> p_0) <span class="sc">*</span> (b_0 <span class="sc">+</span> n_0 <span class="sc">-</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    n_0 <span class="sc">*</span> p_0))<span class="sc">/</span>((a_0 <span class="sc">+</span> b_0 <span class="sc">+</span> n_0)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_0 <span class="sc">+</span> b_0 <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    n_0 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>var_posterior_1 <span class="ot">&lt;-</span> ((a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1) <span class="sc">*</span> (b_1 <span class="sc">+</span> n_1 <span class="sc">-</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    n_1 <span class="sc">*</span> p_1))<span class="sc">/</span>((a_1 <span class="sc">+</span> b_1 <span class="sc">+</span> n_1)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (a_1 <span class="sc">+</span> b_1 <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    n_1 <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>prior_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, prior_0, prior_1, posterior_0,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    posterior_1)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>prior_plot_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(prior_plot, <span class="at">cols =</span> <span class="fu">c</span>(prior_0,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    prior_1, posterior_0, posterior_1))</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name,</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"posterior"</span>) <span class="sc">==</span> T, <span class="st">"Posterior"</span>, <span class="st">"Prior"</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>prior_plot_long<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(prior_plot_long<span class="sc">$</span>name,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_0"</span>) <span class="sc">==</span> T, <span class="st">"Control arm"</span>, <span class="st">"Active arm"</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prior_plot_long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">linetype =</span> type,</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> group)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"vertical"</span>) <span class="sc">+</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">str_glue</span>(<span class="st">"Assumed event probabilities: Control arm (p_0="</span>,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        p_0, <span class="st">"), "</span>, <span class="st">"Active arm (p_1="</span>, p_1, <span class="st">")</span><span class="sc">\n</span><span class="st">Posterior standard deviation: Control arm="</span>,</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_0), <span class="dv">3</span>), <span class="st">", "</span>, <span class="st">"Active arm="</span>,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>(<span class="fu">sqrt</span>(var_posterior_1), <span class="dv">3</span>))) <span class="sc">+</span> <span class="fu">scale_color_brewer</span>(<span class="st">"Treatment arm"</span>,</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span> <span class="fu">scale_linetype</span>(<span class="st">"Type"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Noninformative prior"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/fig22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>We denote the joint posterior distribution as <span class="math display">\[
f_2(p_1, p_0|r_0, r_1, n_0, n_1)=\prod_{i\in\{0,1\}} \frac{p_i^{a_i+r_i-1}(1-p_i)^{b_i+n_i-r_i-1}}{B(a_i+r_i, b_i+n_i-r_i)}.
\]</span> and thus, by using Fubini’s theorem, <span class="math display">\[
\begin{aligned}
P&amp;\left(p_1-p_0 \leq \delta^*\right|r_0, r_1, n_0, n_1)=1-P\left(p_1-p_0 &gt; \delta^*\right|r_0, r_1, n_0, n_1) \\
&amp;=\int_{\delta^*}^{1}\int_0^{p_0-\delta^*} f_2(p_1, p_0|r_0, r_1, n_0, n_1)dp_1dp_0 \\
&amp;=\int_{\delta^*}^{1}\frac{p_0^{a_0+r_0-1}(1-p_0)^{b_0+n_0-r_0-1}}{B(a_0+r_0, b_0+n_0-r_0)}\left(\int_0^{p_0-\delta^*} \frac{p_1^{a_1+r_1-1}(1-p_1)^{b_1+n_1-r_1-1}}{B(a_1+r_1, b_1+n_1-r_1)}dp_1\right)dp_0 \\
&amp;=\int_{\delta^*}^{1}\frac{p_0^{a_0+r_0-1}(1-p_0)^{b_0+n_0-r_0-1}}{B(a_0+r_0, b_0+n_0-r_0)}F_{B(a_1+r_1,b_1+n_1-r_1)}(p_0-\delta^*)dp_0,
\end{aligned}
\]</span> is the <strong>Bayesian probability to reject</strong> given the observed <span class="math inline">\(r_0, r_1, n_0, n_1\)</span>, and where <span class="math inline">\(F_{B(a_1+r_1,b_1+n_1-r_1)}\)</span> is the cumulative distribution function of a beta distribution.</p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We calculate the Bayesian probability to reject for the SAFE-SSPE study.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Enthusiastic prior</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">7.2</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>)<span class="sc">/</span>(<span class="fl">0.03</span>) <span class="sc">*</span> a_0</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>bap <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) (x)<span class="sc">^</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">^</span>(b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">pbeta</span>(x<span class="sc">-</span>delta_star, a_1<span class="sc">+</span>n_1<span class="sc">*</span>p_1, b_1<span class="sc">+</span>n_1<span class="sc">-</span>n_1<span class="sc">*</span>p_1), <span class="at">lower =</span> delta_star, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0, b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">seq</span>(a_1 <span class="sc">+</span> n_1 <span class="sc">*</span> p_1, b_1 <span class="sc">+</span> n_1 <span class="sc">-</span> n_1 <span class="sc">*</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    p_1 <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>bap <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) (x)<span class="sc">^</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">^</span>(b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">pbeta</span>(x<span class="sc">-</span>delta_star, a_1<span class="sc">+</span>n_1<span class="sc">*</span>p_1, b_1<span class="sc">+</span>n_1<span class="sc">-</span>n_1<span class="sc">*</span>p_1), <span class="at">lower =</span> delta_star, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0, b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>res_bap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Enthusiastic"</span>, bap)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">2.84</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">/</span><span class="fl">0.05</span> <span class="sc">*</span> a_1</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">1.24</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>bap <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) (x)<span class="sc">^</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">^</span>(b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">pbeta</span>(x<span class="sc">-</span>delta_star, a_1<span class="sc">+</span>n_1<span class="sc">*</span>p_1, b_1<span class="sc">+</span>n_1<span class="sc">-</span>n_1<span class="sc">*</span>p_1), <span class="at">lower =</span> delta_star, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0, b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>res_bap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_bap, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Skeptical"</span>, bap))</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_1)<span class="sc">/</span>p_1 <span class="sc">*</span> a_1</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> p_0)<span class="sc">/</span>p_0 <span class="sc">*</span> a_0</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>bap <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) (x)<span class="sc">^</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">^</span>(b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">pbeta</span>(x<span class="sc">-</span>delta_star, a_1<span class="sc">+</span>n_1<span class="sc">*</span>p_1, b_1<span class="sc">+</span>n_1<span class="sc">-</span>n_1<span class="sc">*</span>p_1), <span class="at">lower =</span> delta_star, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0, b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0))</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>res_bap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_bap, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Informative"</span>, bap))</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Noninformative prior</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>b_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>bap <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) (x)<span class="sc">^</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">^</span>(b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">pbeta</span>(x<span class="sc">-</span>delta_star, a_1<span class="sc">+</span>n_1<span class="sc">*</span>p_1, b_1<span class="sc">+</span>n_1<span class="sc">-</span>n_1<span class="sc">*</span>p_1), <span class="at">lower =</span> delta_star, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(a_0<span class="sc">+</span>n_0<span class="sc">*</span>p_0, b_0<span class="sc">+</span>n_0<span class="sc">-</span>n_0<span class="sc">*</span>p_0))</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>res_bap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_bap, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Noninformative"</span>, bap))</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>res_bap<span class="sc">$</span>bap <span class="ot">&lt;-</span> <span class="fu">round</span>(res_bap<span class="sc">$</span>bap, <span class="dv">2</span>)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>res_bap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            type  bap
1   Enthusiastic 0.03
2      Skeptical 0.00
3    Informative 0.01
4 Noninformative 0.03</code></pre>
</div>
</div>
<hr>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-Kunzmann2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Kunzmann K, Grayling MJ, Lee KM, Robertson DS, Rufibach K, Wason JMS. A review of bayesian perspectives on sample size derivation for confirmatory trials. The American Statistician. 2021;75: 424–432. doi:<a href="https://doi.org/10.1080/00031305.2021.1901782">10.1080/00031305.2021.1901782</a></div>
</div>
<div id="ref-Spiegelhalter2003" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Spiegelhalter DJ, Abrams KR, Myles JP. Bayesian approaches to clinical trials and health‐care evaluation. Wiley; 2003. doi:<a href="https://doi.org/10.1002/0470092602">10.1002/0470092602</a></div>
</div>
<div id="ref-Baumgartner2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Baumgartner C, Klok FA, Carrier M, Limacher A, Moor J, Righini M, et al. Clinical surveillance vs. Anticoagulation for low-risk patiEnts with isolated SubSegmental pulmonary embolism: Protocol for a multicentre randomised placebo-controlled non-inferiority trial (SAFE-SSPE). BMJ Open. 2020;10: e040151. doi:<a href="https://doi.org/10.1136/bmjopen-2020-040151">10.1136/bmjopen-2020-040151</a></div>
</div>
<div id="ref-Grieve2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Grieve AP. Hybrid frequentist/bayesian power and bayesian power in planning clinical trials. Chapman; Hall/CRC; 2022. doi:<a href="https://doi.org/10.1201/9781003218531">10.1201/9781003218531</a></div>
</div>
<div id="ref-OHagan2005" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">O’Hagan A, Stevens JW, Campbell MJ. Assurance in clinical trial design. Pharmaceutical Statistics. 2005;4: 187–201. doi:<a href="https://doi.org/10.1002/pst.175">10.1002/pst.175</a></div>
</div>
<div id="ref-Rufibach2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Rufibach K, Burger HU, Abt M. Bayesian predictive power: Choice of prior and some recommendations for its use as probability of success in drug development. Pharmaceutical Statistics. 2016;15: 438–446. doi:<a href="https://doi.org/10.1002/pst.1764">10.1002/pst.1764</a></div>
</div>
<div id="ref-Gelman2013" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Gelman A, Carlin JB, Stern HS, Dunson DB, Vehtari A, Rubin DB. Bayesian data analysis. Chapman; Hall/CRC; 2013. doi:<a href="https://doi.org/10.1201/b16018">10.1201/b16018</a></div>
</div>
<div id="ref-Muirhead2013" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Muirhead RJ, Şoaita AI. On an approach to bayesian sample sizing in clinical trials. 2013; 126–137. doi:<a href="https://doi.org/10.1214/12-IMSCOLL1007">10.1214/12-IMSCOLL1007</a></div>
</div>
<div id="ref-Agresti2005" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Agresti A, Min Y. Frequentist performance of bayesian confidence intervals for comparing proportions in 2 × 2 contingency tables. Biometrics. 2005;61: 515–523. doi:<a href="https://doi.org/10.1111/j.1541-0420.2005.031228.x">10.1111/j.1541-0420.2005.031228.x</a></div>
</div>
<div id="ref-Agresti2000" class="csl-entry" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Agresti A, Caffo B. Simple and effective confidence intervals for proportions and differences of proportions result from adding two successes and two failures. The American Statistician. 2000;54: 280. doi:<a href="https://doi.org/10.2307/2685779">10.2307/2685779</a></div>
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02-PhaseII.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phase II trials</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>