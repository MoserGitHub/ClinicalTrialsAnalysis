<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clinical trials analysis - 3&nbsp; Phase II trials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./references.html" rel="next">
<link href="./01-NI.html" rel="prev">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-PhaseII.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phase II trials</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Clinical trials analysis</a> 
        <div class="sidebar-tools-main">
    <a href="./Clinical-trials-analysis.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-NI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power and sample size calculations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-PhaseII.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phase II trials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#single-arm-design" id="toc-single-arm-design" class="nav-link active" data-scroll-target="#single-arm-design"><span class="header-section-number">3.1</span> Single arm design</a>
  <ul>
  <li><a href="#decision-rules-for-stopping-the-trial" id="toc-decision-rules-for-stopping-the-trial" class="nav-link" data-scroll-target="#decision-rules-for-stopping-the-trial"><span class="header-section-number">3.1.1</span> Decision rules for stopping the trial</a></li>
  <li><a href="#simulation-study" id="toc-simulation-study" class="nav-link" data-scroll-target="#simulation-study"><span class="header-section-number">3.1.2</span> Simulation study</a>
  <ul class="collapse">
  <li><a href="#prior-with-a0.4-b0.6" id="toc-prior-with-a0.4-b0.6" class="nav-link" data-scroll-target="#prior-with-a0.4-b0.6"><span class="header-section-number">3.1.2.1</span> Prior with a=0.4, b=0.6</a></li>
  <li><a href="#prior-with-a1-b4" id="toc-prior-with-a1-b4" class="nav-link" data-scroll-target="#prior-with-a1-b4"><span class="header-section-number">3.1.2.2</span> Prior with a=1, b=4</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#randomised-non-comparitive-two-arm-design-with-adaptive-excessive-toxicity-treshold" id="toc-randomised-non-comparitive-two-arm-design-with-adaptive-excessive-toxicity-treshold" class="nav-link" data-scroll-target="#randomised-non-comparitive-two-arm-design-with-adaptive-excessive-toxicity-treshold"><span class="header-section-number">3.2</span> Randomised non-comparitive two arm design with adaptive excessive toxicity treshold</a>
  <ul>
  <li><a href="#simulation-study-1" id="toc-simulation-study-1" class="nav-link" data-scroll-target="#simulation-study-1"><span class="header-section-number">3.2.1</span> Simulation study</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phase II trials</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Phase II trials are often single-arm trials in early phases but can also be multi-arm (non-)randomized controlled trials in later phases <span class="citation" data-cites="Mossop2022">[<a href="references.html#ref-Mossop2022" role="doc-biblioref">1</a>]</span>. The aim of early phase-II designs is to assess efficacy of a new treatment measured by clinical response in a small population of 30-100 patients. Early phase II trials can be designed as two- or three stage trials using frequentist approaches like Simon’s two stage design. In this chapter we use a Bayesian predictive probability approach to analyse an early phase-II trial <span class="citation" data-cites="Lee2008">[<a href="references.html#ref-Lee2008" role="doc-biblioref">2</a>]</span> <span class="citation" data-cites="Sambucini2021">[<a href="references.html#ref-Sambucini2021" role="doc-biblioref">3</a>]</span>. The aim is to compare two different decision rules for early stopping the trial: One uses the posterior distribution given the interim data, the second one uses the predictive distribution given the interim data and future events.</p>
<section id="single-arm-design" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="single-arm-design"><span class="header-section-number">3.1</span> Single arm design</h2>
<p>Let <span class="math inline">\(p\)</span> the true toxicity rate and <span class="math inline">\(\pi \sim Beta(a,b)\)</span> be a design prior on <span class="math inline">\(p\)</span>. Our null hypothesis of interest is <span class="math inline">\(H_0: p \leq p_0\)</span> versus <span class="math inline">\(H_1: p&gt;p_0\)</span>, that is, we compare, say, the clinical response <span class="math inline">\(p\)</span> toa prespecified threshold <span class="math inline">\(p_0\)</span>. Suppose that we plan interim looks <span class="math inline">\(j\geq 1\)</span> after <span class="math inline">\(n_j\)</span> patients were recruited and <span class="math inline">\(r_j\)</span> toxicity events occurred. Under the prior <span class="math inline">\(\pi\)</span> the posterior distribution is beta distributed <span class="math inline">\(p|r_j, n_j \sim Beta(a+r_j, b+n_j-r_j)\)</span>. Suppose that we plan to recruit <span class="math inline">\(N_{max}\)</span> patients. Let <span class="math inline">\(S_j\)</span> be the number of toxic events in future <span class="math inline">\(m_j=N_{max}-n_j\)</span> patients at interim look <span class="math inline">\(j\geq 1\)</span>. Under the prior <span class="math inline">\(\pi\)</span>, <span class="math inline">\(S_j\)</span> is Beta-binomial distributed <span class="math inline">\(S_j \sim Betabinomal(i|m_j, a+r_j, b+n_j-r_j)\)</span> and <span class="math inline">\(p|r_j,y_j \sim Beta(a+r_j+s_j, b+N_{max}-n_j-r_j-s_i)\)</span>.</p>
<hr>
<p><strong>Working example</strong></p>
<p>Suppose that the goal of a phase-II trial is to evaluate safety of new chemotherapy treatment investigating the discontinuation rate <span class="math inline">\(p\)</span> as primary endpoint. Discontinuation is defined based on toxicity grading from the US National Cancer Institute Common Terminology Criteria for Adverse Events (CTCAE).</p>
<hr>
<section id="decision-rules-for-stopping-the-trial" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="decision-rules-for-stopping-the-trial"><span class="header-section-number">3.1.1</span> Decision rules for stopping the trial</h3>
<p><strong>Early stopping using the posterior distribution</strong></p>
<p>The decision to the stop the trial early is based on the decision rule <span class="math inline">\(P(p&gt; p_0|r_j, n_j)&gt;\theta_T\)</span>, that is, the posterior distribution given the interim data. If the trial is not stopped early we recruit more patients until <span class="math inline">\(N_{max}\)</span> is reached.</p>
<p><strong>Early stopping using the predictive distribution</strong></p>
<p>The predictive probability that <span class="math inline">\(p|r_j, n_j\)</span> is larger that <span class="math inline">\(p_{max}\)</span> at the end of the trial is</p>
<p><span class="math display">\[
PP_j=\sum_{i=0}^{m_j}I(P(p&gt; p_{max}|r_j, n_j, S_j=s_j)&gt;\theta_T)\cdot P(S_j=s_j|r_j, n_j), \quad j\geq 1.
\]</span> If <span class="math inline">\(PP_j&gt;\theta_S\)</span> then we stop the trial because of safety concerns, otherwise we recruit more patients until <span class="math inline">\(N_{max}\)</span> is reached. Usually, <span class="math inline">\(\theta_S\)</span> is chosen to be high (&gt;0.8) <span class="citation" data-cites="Sambucini2021">[<a href="references.html#ref-Sambucini2021" role="doc-biblioref">3</a>]</span>.</p>
<hr>
<p><strong>Working example</strong></p>
<p>Based on prior evidence <span class="math inline">\(p_{max}\)</span> is set to 0.2. This threshold is based on a result from a previous study where the treatment discontinuation was estimated with 0.17 with 95% confidence intervals (0.10-0.27). Below we show the prior distributions for different parameters <span class="math inline">\(a=1\)</span>, <span class="math inline">\(b=4\)</span> (weight of 5 patients) and <span class="math inline">\(a=2\)</span>, <span class="math inline">\(b=8\)</span> (weight of 10 patients). The mean of the prior is in both cases 0.2.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior information</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="fl">0.001</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>data_prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, <span class="at">y=</span><span class="fu">dbeta</span>(x, a_0, b_0), <span class="at">type=</span><span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior information</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>data_prior <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data_prior, <span class="fu">data.frame</span>(x, <span class="at">y=</span><span class="fu">dbeta</span>(x, a_0, b_0), <span class="at">type=</span><span class="dv">2</span>))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>data_prior<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_prior<span class="sc">$</span>type, <span class="at">levels=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"a=0.4, b=0.6"</span>, <span class="st">"a=1, b=4"</span>))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_prior <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y<span class="sc">&lt;</span><span class="dv">5</span>), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">linetype=</span>type, <span class="at">group=</span>type))<span class="sc">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>))<span class="sc">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="st">"Prior parameters"</span>)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">"red"</span>, <span class="at">linetype=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">"red"</span>, <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Different beta prior parameter choices"</span>)<span class="sc">+</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption=</span><span class="fu">c</span>(<span class="st">"Red vertical lines indicate mean values of priors."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>p_max <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior information</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>a_0 <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>b_0 <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">35</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_max <span class="ot">&lt;-</span> <span class="dv">35</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>, n_max, <span class="dv">5</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n_max</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> n_max<span class="sc">-</span>r</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.001</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>theta_T <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">n=</span>n, <span class="at">r=</span>r) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(n) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n<span class="sc">&gt;=</span>r) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">i=</span>n_max<span class="sc">-</span>n<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">expandRows</span>(data, <span class="at">count=</span><span class="dv">3</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(n, r) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">m=</span>n_max<span class="sc">-</span>n, <span class="at">ind=</span><span class="dv">1</span>, <span class="at">i=</span><span class="fu">cumsum</span>(ind)<span class="sc">-</span><span class="dv">1</span>, <span class="at">ind=</span><span class="cn">NULL</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cond_postprob=</span><span class="fu">dbbinom</span>(i, <span class="at">size=</span>m, <span class="at">alpha=</span>a_0<span class="sc">+</span>r, <span class="at">beta=</span>b_0<span class="sc">+</span>n<span class="sc">-</span>r), </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Ti=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">pbeta</span>(p_max, a_0<span class="sc">+</span>r<span class="sc">+</span>i, b_0<span class="sc">+</span>n_max<span class="sc">-</span>r<span class="sc">-</span>i), </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ind=</span><span class="fu">ifelse</span>(Ti<span class="sc">&gt;</span>theta_T, <span class="dv">1</span>, <span class="dv">0</span>), n_max)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(n_max, n, r, m, i, cond_postprob, Ti, ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Suppose we plan a phase-II with a maximum of <span class="math inline">\(N_{max}=35\)</span> patients. Let us consider the situation where we have reached an initial <span class="math inline">\(n_1=10\)</span> with <span class="math inline">\(r_1=2\)</span> observed toxicities and we have to decide whether to stop or continue the trial. Specifically, we calculate for each potential future toxicity from <span class="math inline">\(m_1\)</span> patients and decide whether <span class="math inline">\(T_{i,1}&gt;\theta_T=0.8\)</span>. The column <em>cond_postprob</em> in the following table is <span class="math inline">\(p|r_1,n_1, s_1\)</span> (because it is conditional on the future outcome <span class="math inline">\(S_{j,i}=s_j\)</span>) and the column <span class="math inline">\(Ti\)</span> corresponds to <span class="math inline">\(T_{1,i}\)</span>.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n<span class="sc">==</span><span class="dv">10</span>, r<span class="sc">==</span><span class="dv">2</span>, i<span class="sc">&lt;=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 8
# Groups:   n, r [1]
   n_max     n     r     m     i cond_postprob      Ti   ind
   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1    35    10     2    25     0       0.0434  0.00789     0
 2    35    10     2    25     1       0.0799  0.0315      0
 3    35    10     2    25     2       0.103   0.0881      0
 4    35    10     2    25     3       0.114   0.190       0
 5    35    10     2    25     4       0.114   0.334       0
 6    35    10     2    25     5       0.107   0.500       0
 7    35    10     2    25     6       0.0958  0.661       0
 8    35    10     2    25     7       0.0821  0.793       0
 9    35    10     2    25     8       0.0678  0.887       1
10    35    10     2    25     9       0.0542  0.945       1
11    35    10     2    25    10       0.0419  0.976       1
12    35    10     2    25    11       0.0313  0.990       1
13    35    10     2    25    12       0.0227  0.997       1
14    35    10     2    25    13       0.0159  0.999       1
15    35    10     2    25    14       0.0107  1.00        1
16    35    10     2    25    15       0.00690 1.00        1</code></pre>
</div>
</div>
<p>Based on this information we calculate <span class="math inline">\(PP_1\)</span> and decide based on the threshold <span class="math inline">\(\theta_S=0.9\)</span> whether to stop the trial early or to accrual more patients. For the decision rule based on the posterior probability we calculate the decision to stop the trial using the posterior distribution and use the threshold <span class="math inline">\(\theta_T=0.75\)</span>.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>threshold_safety <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Early stopping using predictive distribution</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>data_pp <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(n, r) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">pp=</span><span class="fu">round</span>(<span class="fu">sum</span>(cond_postprob<span class="sc">*</span>ind),<span class="dv">6</span>), </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">stop_pp=</span><span class="fu">ifelse</span>(pp<span class="sc">&gt;</span>threshold_safety, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Early stopping using posterior distribution</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>data_pp <span class="ot">&lt;-</span> data_pp <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stop_postdist=</span><span class="fu">ifelse</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pbeta</span>(p_max, a_0<span class="sc">+</span>r, b_0<span class="sc">+</span>n<span class="sc">-</span>r)<span class="sc">&gt;</span>theta_T, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>data_pp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n<span class="sc">==</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
# Groups:   n [1]
       n     r      pp stop_pp stop_postdist
   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
 1    10     0 0.00315       0             0
 2    10     1 0.0588        0             0
 3    10     2 0.261         0             0
 4    10     3 0.582         0             0
 5    10     4 0.847         0             1
 6    10     5 0.966         1             1
 7    10     6 0.996         1             1
 8    10     7 1.00          1             1
 9    10     8 1.00          1             1
10    10     9 1             1             1
11    10    10 1             1             1</code></pre>
</div>
</div>
<p>For each interim look <span class="math inline">\(j\geq1\)</span> we can then calculate stopping of safety boundaries of the trial. Here we assumed that we recruit 5 additional patients if we do not stop the trial early.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_pp_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(data_pp, <span class="at">cols=</span><span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>stop_boundaries <span class="ot">&lt;-</span> data_pp_long <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, n) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">r=</span><span class="fu">min</span>(r), <span class="at">stop=</span><span class="cn">NULL</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>stop_boundaries<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">factor</span>(stop_boundaries<span class="sc">$</span>name, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"stop_postdist"</span>, <span class="st">"stop_pp"</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Posterior distribution"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Predictive distribution"</span>))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stop_boundaries, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span>r, <span class="at">linetype=</span>name))<span class="sc">+</span><span class="fu">geom_step</span>()<span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(stop_boundaries<span class="sc">$</span>r)), </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span> <span class="fu">max</span>(stop_boundaries<span class="sc">$</span>r))<span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of toxic events"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Number of patients at interim analysis"</span>)<span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Stopping for safety boundaries"</span>)<span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="simulation-study" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="simulation-study"><span class="header-section-number">3.1.2</span> Simulation study</h3>
<section id="prior-with-a0.4-b0.6" class="level4" data-number="3.1.2.1">
<h4 data-number="3.1.2.1" class="anchored" data-anchor-id="prior-with-a0.4-b0.6"><span class="header-section-number">3.1.2.1</span> Prior with a=0.4, b=0.6</h4>
<p>We set up a simulation study to quantify operations characteristics (probability of early stopping, the probability to declare toxicity and expected number of patients and toxicities) with the following parameters</p>
<ul>
<li>Beta prior parameters: a=0.4, b=0.6</li>
<li>True <span class="math inline">\(p\)</span>: 0.2, 0.25, 0.3</li>
<li><span class="math inline">\(p_0\)</span>: 0.2</li>
<li><span class="math inline">\(N_0\)</span>: 10</li>
<li>Cohort increase: 5</li>
<li><span class="math inline">\(N_{max}\)</span>: 30, 35, 40</li>
<li><span class="math inline">\(\theta_T\)</span>: 0.75, 0.9</li>
<li><span class="math inline">\(\theta_S\)</span>: 0.8, 0.9, 1</li>
<li>Number of simulation runs: 1000</li>
</ul>
<p>Stopping decision rules:</p>
<ul>
<li>Posterior distribution: Stop early if <span class="math inline">\(P(p&gt; p_0|N_j)&gt;\theta_T\)</span>,</li>
<li>Safety threshold: Stop early if <span class="math inline">\(T_{j,i}&gt;\theta_T\)</span> and <span class="math inline">\(PP_j&gt;\theta_S\)</span>.</li>
</ul>
<p>Note that the type-I and type-II errors correspond to the proportion of trials which stopped early. If the maximal number of patients was reached the trial cannot be stopped early.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="prior-with-a1-b4" class="level4" data-number="3.1.2.2">
<h4 data-number="3.1.2.2" class="anchored" data-anchor-id="prior-with-a1-b4"><span class="header-section-number">3.1.2.2</span> Prior with a=1, b=4</h4>
<p>We use the same simulation approach as in the previous subsection but using a a Beta prior with parameters a=1 and b=4.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
</section>
</section>
<section id="randomised-non-comparitive-two-arm-design-with-adaptive-excessive-toxicity-treshold" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="randomised-non-comparitive-two-arm-design-with-adaptive-excessive-toxicity-treshold"><span class="header-section-number">3.2</span> Randomised non-comparitive two arm design with adaptive excessive toxicity treshold</h2>
<p>Suppose we randomise patients with a 1:1 allocation ratio to an experimental and a control arm. The <span class="math inline">\(j\)</span>th interim analysis will be performed after the recruitment of <span class="math inline">\(N_j=n_{j,0}+n_{j,1}\)</span> patients (<span class="math inline">\(n_{j,0}\)</span> denotes the number of patients in the control arm and <span class="math inline">\(n_{j,1}\)</span> denotes the number of patients in the experimental arm). For notational simplicity we skip the index <span class="math inline">\(j\)</span> in the following.</p>
<p>Suppose that at an interim analysis <strong>in the experimental arm</strong> <span class="math inline">\(r_{1}\)</span> toxicities are observed. If we assume that <span class="math inline">\(N_{max}=n_{max, 0}+n_{max, 1}\)</span> is the planned sample size of the trial, then a remaining future <span class="math inline">\(m_{1}=n_{max, 1}-n_{1}\)</span> will be recruited in the experimental arm with possible future events <span class="math inline">\(S_1\in\{0,\cdots, m_1\}\)</span>.</p>
<p><strong>The trial is stopped early</strong> if <span class="math inline">\(PP_{1}&gt;\theta_S\)</span>, where <span class="math display">\[
\begin{aligned}
PP_{Safety}&amp;=E\left[I\left\{ P\left(p_1-p_{max}|r_{1}, n_{1}, s_{1}\right)&gt;\theta_T\right\}|r_{1}, n_{1}\right] \\
&amp;=\sum_{s_1=0}^{m_1} I(P(p_1 &gt; p_{max}|r_{1},n_1,s_1)&gt;\theta_T) P(S_{1}=s_1|r_{1}).
\end{aligned}
\]</span> That is, we stop the trial early if the expected probability that <span class="math inline">\(p_1\)</span> is greater than <span class="math inline">\(p_max\)</span> at the end of the trial is above <span class="math inline">\(\theta_S\)</span>.</p>
<p>If <span class="math inline">\(PP_{S}\leq \theta_S\)</span> then <span class="math inline">\(n^*\)</span> new patients are randomised.</p>
<p>At each interim step, <strong>we allow the threshold toxicity rate to be adapted</strong>. Let</p>
<p><span class="math display">\[
\begin{aligned}
PP_{diff}&amp;=E\left[I\left\{ P\left(p_{0}-p_{1}&gt; \delta|r_{0}, r_{1}, n_{0}, n_{1}, s_{0}, s_{1}\right)&gt;\omega\right\}|r_{0}, r_{1}, n_{0}, n_{1}\right] \\
&amp;=\sum_{s_0=0}^{m_0}\sum_{s_1=0}^{m_1}I\left\{ P\left(p_{0}-p_{1}&gt; \delta|r_{0}, r_{1}, n_{0}, n_{1}, s_{0}, s_{1}\right)&gt;\omega\right\} \\
&amp;\quad \quad \quad \quad \quad \quad \cdot P(S_0=s_0|r_0, n_0)P(S_1=s_1|r_1, n_1),
\end{aligned}
\]</span> be the expected probablity of a relevant toxicity difference <span class="math inline">\(p_0-p_1\)</span> at the end of the trial given interim data <span class="citation" data-cites="Dmitrienko2006">[<a href="references.html#ref-Dmitrienko2006" role="doc-biblioref">4</a>]</span>. <span class="math inline">\(S_i\)</span> are Beta-binomial distributed <span class="math inline">\(P(S_i=s_i|r_i,n_i) \sim Betabinomial(m_i, a_i+r_i, b_i-n_{max,i}-r_i)\)</span>. Note that</p>
<p><span class="math display">\[
\begin{aligned}
P&amp;\left(p_{0}-p_{1}&gt; \delta|r_{0}, r_{1}, n_{0}, n_{1}, s_{0}, s_{1}\right)=\int_{\delta}^1\int_0^{p-\delta} f(p_0, p_1|r_0, n_0, r_1, n_1, s_0, s_1)dp_0dp_1 \\
&amp;=\int_{\delta}^1\frac{p^{a_0+r_0+s_0-1}(1-p)^{b_0+n_{0,max}-r_0-s_0-1}}{B(a_0+r_0+s_0, b_0+n_{0,max}-r_0-s_0)}\int_0^{p-\delta}\frac{q^{a_1+r_1+s_1-1}(1-q)^{b_1+n_{1,max}-r_1-s_1-1}}{B(a_1+r_1+s_1, b_1+n_{1,max}-r_1-s_1)}dp \\
&amp;=\int_{\delta}^1\frac{p^{a_0+r_0+s_0-1}(1-p)^{b_0+n_{0,max}-r_0-s_0-1}}{B(a_0+r_0+s_0, b_0+n_{0,max}-r_0-s_0)}F_{B(a_1+r_1+s_1,b_1+n_1-r_1-s_1)}(p-\delta^*)dp,
\end{aligned}
\]</span> where <span class="math inline">\(F_{B(\cdot,\cdot)}\)</span> is the cumulative distribution function of a Beta distribution.</p>
<p>If <span class="math inline">\(PP_{diff}&gt;\theta_D\)</span> then <span class="math inline">\(p_{max}\)</span> is reduced by <span class="math inline">\(d_{max}\)</span> until a lower bound <span class="math inline">\(p_{max}^l\)</span> is reached. If <span class="math inline">\(PP_{diff}\leq \theta_D\)</span>, then <span class="math inline">\(p_{max}\)</span> remains unchanged.</p>
<p>The following figure summarises the trial process:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/fig1-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<section id="simulation-study-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="simulation-study-1"><span class="header-section-number">3.2.1</span> Simulation study</h3>
<p>We set up a simulation study (“Threshold adaption”) to quantify operations characteristics</p>
<ul>
<li>Probability of early stopping (stopping trial before <span class="math inline">\(N_{max}\)</span> is reached),</li>
<li>Probability of toxicity (declaring toxicity including <span class="math inline">\(N_{max}\)</span>),</li>
<li>Probability of efficacy (high probability that experimental arm has a lower toxcity by at least <span class="math inline">\(\delta\)</span> compared to control arm)</li>
<li>Average (adapted) maximal toxicity threshold</li>
<li>Expected number of patients per arm</li>
</ul>
<p>with the following parameters</p>
<ul>
<li>Beta prior parameters: Control arm: a=2, b=8; Experimental arm, a=1, b=4</li>
<li>True control <span class="math inline">\(p0\)</span>: 0.1, 0.2, 0.3</li>
<li>True experimental <span class="math inline">\(p1\)</span>: 0.1, 0.2, 0.3</li>
<li>Maximal toxicity threshold <span class="math inline">\(p_{max}\)</span>: 0.2</li>
<li>Reduction of maximal toxicity threshold <span class="math inline">\(d_{max}\)</span>: 0.02</li>
<li>Lower bound of maximal toxicity threshold <span class="math inline">\(p_{max}^l\)</span>: 0.1</li>
<li>Sample size at first interim analysis <span class="math inline">\(N_1\)</span>: 8</li>
<li>Increase of sample size <span class="math inline">\(n_{increase}\)</span>: 4 (2 patients per arm)</li>
<li>Planned sample size <span class="math inline">\(N_{max}\)</span>: 40, 48, 56 (20, 24, 28 patients per arm)</li>
<li>Excessive toxicity probability for posterior distribution <span class="math inline">\(\theta_T\)</span>: 0.8</li>
<li>Safety threshold for predictive distribution <span class="math inline">\(\theta_S\)</span>: 0.8</li>
<li>Toxicity difference margin <span class="math inline">\(\delta\)</span>: 0.025</li>
<li>Number of simulation runs: 500</li>
</ul>
<p>A second simulation study (“No threshold adaption”) does not adapt the discontinuation threshold at interim analyses.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-15-3.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-15-4.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-PhaseII_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-Mossop2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Mossop H, Grayling MJ, Gallagher FA, Welsh SJ, Stewart GD, Wason JMS. Advantages of multi-arm non-randomised sequentially allocated cohort designs for phase II oncology trials. British Journal of Cancer. 2022;126: 204–210. doi:<a href="https://doi.org/10.1038/s41416-021-01613-5">10.1038/s41416-021-01613-5</a></div>
</div>
<div id="ref-Lee2008" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Lee JJ, Liu DD. A predictive probability design for phase II cancer clinical trials. Clinical Trials. 2008;5: 93–106. doi:<a href="https://doi.org/10.1177/1740774508089279">10.1177/1740774508089279</a></div>
</div>
<div id="ref-Sambucini2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Sambucini V. Efficacy and toxicity monitoring via bayesian predictive probabilities in phase II clinical trials. Statistical Methods &amp; Applications. 2021;30: 637–663. doi:<a href="https://doi.org/10.1007/s10260-020-00537-3">10.1007/s10260-020-00537-3</a></div>
</div>
<div id="ref-Dmitrienko2006" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Dmitrienko A, Wang M. Bayesian predictive approach to interim monitoring in clinical trials. Statistics in Medicine. 2006;25: 2178–2195. doi:<a href="https://doi.org/10.1002/sim.2204">10.1002/sim.2204</a></div>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01-NI.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power and sample size calculations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>